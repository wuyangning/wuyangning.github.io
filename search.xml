<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>不同构型旋翼无人机的控制</title>
      <link href="/2023/01/27/y2023m01/%E4%B8%8D%E5%90%8C%E6%9E%84%E5%9E%8B%E6%97%8B%E7%BF%BC%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%9A%84%E6%8E%A7%E5%88%B6/"/>
      <url>/2023/01/27/y2023m01/%E4%B8%8D%E5%90%8C%E6%9E%84%E5%9E%8B%E6%97%8B%E7%BF%BC%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%9A%84%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p><strong>摘要：讨论由多组倾转或固定旋翼驱动的单一刚体无人机的姿态/位置轨迹跟踪控制。包含的无人机类型有：正X型四旋翼(Quadcopter)，倾转三旋翼(Tricopter)，倾转双旋翼(Bicopter)，矢量共轴双旋翼(Singlecopter)，全驱动倾转三旋翼，全驱动六旋翼。</strong><br><span id="more"></span></p><h1><span id="1-不同构型旋翼无人机的控制">1 不同构型旋翼无人机的控制</span></h1><p>&emsp;考虑由多组倾转或者固定电机驱动的单一刚体旋翼无人机，有如下假设：</p><ul><li>忽略螺旋桨、电机转子的质量和转动惯量，即除了螺旋桨提供升力和反作用力矩，其他附加的惯性力和科氏力都忽略不计。</li><li>对于倾转旋翼，忽略倾转舵机的响应时间，即假设控制过程中舵机能够快速到达指定角度。</li><li>忽略其他空气动力学因素产生的作用力。</li><li>无人机的重心和质心重合，即重力的作用不会使机体发生旋转。</li><li>不考虑环境扰动。</li></ul><p>则旋翼无人机控制问题可以被简化为一个刚体的控制问题，对于给定的期望轨迹和测量得到的状态量，基于简化的刚体动力学，设计位置和姿态控制器，得到期望的机体作用力和力矩，再结合无人机构型，计算电机的混控，由位置和姿态控制的输入计算期望电机输出和舵机转角。其大致的控制流程如图所示。</p><p><img src="/img/y2023m01/1-1.png" alt></p><p>需要说明的是：上述假设与实际情况有比较大的差异，但是如果无人机的构型对简化的建模不是特别敏感(各种建模不确定性满足李普希茨条件)的话，利用控制器的高增益，也是能够达到不错的控制效果的。如果需要更好的控制性能，则需要更少的假设，更精确的建模，使用性能更好的控制器等。</p><h2><span id="11-单一刚体的动力学和控制">1.1 单一刚体的动力学和控制</span></h2><p>&emsp;根据牛顿-欧拉法，简化成单一刚体的无人机动力学可以表示为：</p><script type="math/tex; mode=display">\begin{align}&\dot{\boldsymbol{p}}=\boldsymbol{v}\tag{1.1}\\ &\dot{\boldsymbol{v}}=M^{-1}R\boldsymbol{f}-g\boldsymbol{e}_3\tag{1.2}\\ &\dot{R}=R\mathrm{sk}(\boldsymbol{\omega})\tag{1.3}\\ &\dot{\boldsymbol{\omega}}=J^{-1}(-\boldsymbol{\omega}\times J\boldsymbol{\omega}+\boldsymbol{\tau}) \tag{1.4}\end{align}</script><p>其中：</p><ul><li>$\boldsymbol{p}\in\mathbb{R}^3$和$\boldsymbol{v}\in\mathbb{R}^3$分别为无人机在绝对坐标系下的位置和速度。</li><li>$M\in\mathbb{R}$和$J\in\mathbb{R}^{3\times3}$分别为无人机的质量和惯性矩阵。</li><li>$R\in SO(3)$为无人机的姿态旋转矩阵。</li><li>$g$为重力加速度，$\boldsymbol{e}_3=[0,0,1]^{\mathrm{T}}$。</li><li>$\boldsymbol{\omega}$为无人机角速度在机体坐标系下的表示。</li><li>$\boldsymbol{f}\in\mathbb{R}^3$和$\boldsymbol{\tau}\in\mathbb{R}^3$分别为无人机所受力和力矩在机体坐标系下的表示。</li></ul><p>上述动力学中，位置和速度的表示是在绝对坐标系下，角速度的表示则在机体坐标系下。这主要是考虑到实际应用中，传感器测量得到的通常是绝对坐标系下的位置和速度(GPS)，以及机体坐标系下的角速度(IMU)。根据表示状态量的坐标系的不同，动力学的表示也会有所差异。</p><p>&emsp;本文中涉及的无人机可分为非完整约束欠驱动和全驱动两类。对于欠驱动无人机，$\boldsymbol{f}$和$\boldsymbol{\tau}$中存在元素为零或者相互耦合的量，因此在控制中不能全部作为系统的输入，需要结合受控对象选择需要控制的状态量和控制输入。例如平面四旋翼无人机，四个旋翼不能提供机体侧向力，即$\boldsymbol{f}=[0,0,f_z]^{\mathrm{T}}$，为了实现3个自由度的位置控制，需要将$R\boldsymbol{f}$作为位置环的控制输入，再根据这一输入解算出期望的姿态$R$和升力$f_z$，设计姿态控制器进行跟踪。对于全驱动的无人机，$\boldsymbol{f}$和$\boldsymbol{\tau}$总共有六个互相正交的量，每个量都可以独立输入，因此可以将$\boldsymbol{f}$和$\boldsymbol{\tau}$作为系统的输入，分别控制无人机的6个自由度。</p><p>&emsp;对于位置控制器，这里初步将$R\boldsymbol{f}$作为控制输入给出一个能够收敛的控制器。定义期望轨迹为$\boldsymbol{p}_d$，误差$\boldsymbol{e}=\boldsymbol{p}-\boldsymbol{p}_d$，则关于控制误差的位置动力学可以写作：</p><script type="math/tex; mode=display">\ddot{\boldsymbol{e}}=M^{-1}R\boldsymbol{f}-g\boldsymbol{e}_3-\ddot{\boldsymbol{p}}_d \tag{1.5}</script><p>设计控制器为：</p><script type="math/tex; mode=display">R\boldsymbol{f}=M(-k_p\boldsymbol{e}-k_d\dot{\boldsymbol{\boldsymbol{e}}}+g\boldsymbol{e}_3+\ddot{\boldsymbol{p}}_d) \tag{1.6}</script><p>则闭环动力学可以写作：</p><script type="math/tex; mode=display">\ddot{\boldsymbol{e}}+k_d\dot{\boldsymbol{e}}+k_p\boldsymbol{e}=0 \tag{1.7}</script><p>利用二阶线性常系数齐次微分方程的解，可知，当$k_p,k_d&gt;0$且$k_d^2-4k_p&gt;0$时，上述微分方程对应的特征根方程有两个负实数解:$r_1,r_2&lt;0$，微分方程的解为$\boldsymbol{e}=C_1\exp(r_1t)+C_2\exp(r_2t)$，当$t\rightarrow\infty$时$\boldsymbol{e}\rightarrow0$。<br>&emsp;对于姿态控制，可参考 <a href="https://wuyangning.top/2022/11/03/y2022m11/%E5%A7%BF%E6%80%81%E6%8E%A7%E5%88%B6/">刚体姿态控制</a>。</p><p>&emsp;基于设计好控制器，可以计算出控制无人机所需的机体作用力$\boldsymbol{f}$和作用力矩$\boldsymbol{\tau}$，再利用无人机的混控关系求得旋翼的转速和倾转电机的角度。</p><h2><span id="12-电机混控">1.2 电机混控</span></h2><p><img src="/img/y2023m01/1-2.png" alt></p><p>&emsp;无人机每个旋翼提供的升力和反作用力矩如图所示。定义第$i$个螺旋桨的转子坐标系为$R_i$，转子坐标系的$z$轴与电机轴重合。记第$i$个螺旋桨提供的升力和反作用力矩分别$f_i$和$\tau_i$，对于逆时针(CCW)旋转的螺旋桨反作用力矩为负，对于顺时针(CW)旋转的桨反作用力矩为正。$f_i$和$\tau_i$与螺旋桨转速$\omega_i$的关系可以近似为：</p><script type="math/tex; mode=display">\begin{aligned}&f_i=C_f\omega^2_i\\&\tau_i=aC_{\tau}\omega^2_i\end{aligned}\tag{1.8}</script><p>其中$C_f$和$C_{\tau}$是与空气动力学参数相关的系数。$a$表示螺旋桨的旋向，当螺旋桨逆时针(CCW)旋转时，$a=-1$；当螺旋桨顺时针(CW)旋转时，$a=1$。因此可以将$\tau_i$记作：</p><script type="math/tex; mode=display">\tau_i=akf_i \tag{1.9}</script><p>其中$k=C_{\tau}/C_f。$考虑到利用公式就可由升力求得对应的螺旋桨转速，为了简便书写，后续的推导将以螺旋桨的升力作为控制输入。</p><p>&emsp;第$i$个螺旋桨在作用点处的力和力矩在机体坐标系下的表示为：</p><script type="math/tex; mode=display">\begin{align}&F_i=R_i[0,0,f_i]^{\mathrm{T}} \tag{1.10}\\&M_i=R_i[0,0,akf_i]^{\mathrm{T}} \tag{1.11}\end{align}</script><p>将所有力和力矩向质心简化，$n$个螺旋桨提供的合力在机体坐标系下的表示为：</p><script type="math/tex; mode=display">\begin{align}&\boldsymbol{f}=\sum^{n}_{i=1}F_i \tag{1.12}\\&\boldsymbol{\tau}=\sum^{n}_{i=1}\boldsymbol{r}_i\times F_i+M_i \tag{1.13}\end{align}</script><p>其中$\boldsymbol{r}_i$为机体质心到螺旋桨受力点的位置矢量。解(1.11)和(1.12)，就可以由控制输入$\boldsymbol{f}$和$\boldsymbol{\tau}$计算每个螺旋桨的升力和倾转电机的角度。</p><h1><span id="2-欠驱动无人机">2 欠驱动无人机</span></h1><h2><span id="21-平面四旋翼正x型-qaudcopter">2.1 平面四旋翼(正X型-Qaudcopter)</span></h2><p><img src="/img/y2023m01/2-1.png" alt></p><p>&emsp;如图所示，选取螺旋桨1和3产生的反作用力矩为正，螺旋桨2和4产生的反作用力矩为负(力矩的正负可以用右手定则判断)。每个螺旋桨到坐标系x轴和y轴的距离都为$l$。首先，利用第一章中的公式来推导混控矩阵，可以列出以下关系：</p><script type="math/tex; mode=display">R_1=R_2=R_3=R_4=\mathrm{diag}(1,1,1)\tag{2.1}</script><script type="math/tex; mode=display">\begin{aligned}&F_1=R_1[0,0,f_1]^{\mathrm{T}},&M_1&=R_1[0,0,kf_1]^{\mathrm{T}}\\&F_2=R_2[0,0,f_2]^{\mathrm{T}},&M_2&=R_2[0,0,-kf_2]^{\mathrm{T}}\\&F_3=R_3[0,0,f_3]^{\mathrm{T}},&M_3&=R_3[10,0,kf_3]^{\mathrm{T}}\\&F_4=R_4[0,0,f_4]^{\mathrm{T}},&M_4&=R_4[0,0,-kf_4]^{\mathrm{T}}\end{aligned}\tag{2.2}</script><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{r}_1=[l,l,0]^{\mathrm{T}}\\&\boldsymbol{r}_2=[-l,l,0]^{\mathrm{T}}\\&\boldsymbol{r}_3=[-l,-l,0]^{\mathrm{T}}\\&\boldsymbol{r}_4=[l,-l,0]^{\mathrm{T}}\end{aligned}\tag{2.3}</script><p>根据公式(1.12)和(1.13)可以得到：</p><script type="math/tex; mode=display">\boldsymbol{f}=\begin{bmatrix}0\\ 0\\ f_1+f_2+f_3+f_4\end{bmatrix},~\boldsymbol{\tau}=\begin{bmatrix}lf_1+lf_2-lf_3-lf_4\\ -lf_1+lf_2+lf_3-lf_4\\\ kf_1-kf_2+kf_3-kf_4\end{bmatrix}\tag{2.4}</script><p>记$\boldsymbol{f}=[f_x,f_y,f_z]^{\mathrm{T}}$和$\boldsymbol{\tau}_b=[\tau_x,\tau_y,\tau_z]^{\mathrm{T}}$，可以写成矩阵形式：</p><script type="math/tex; mode=display">\begin{bmatrix}f_z\\ \tau_x\\\tau_y\\\tau_z\end{bmatrix}=\begin{bmatrix}1&1&1&1\\ l&l&-l&-l\\ -l&l&l&-l\\k&-k&k&-k\end{bmatrix}\begin{bmatrix}f_1\\ f_2\\f_3\\f_4\end{bmatrix}\tag{2.5}</script><p>对公式(2.5)求逆可以得到：</p><script type="math/tex; mode=display">\begin{bmatrix}f_1\\ f_2\\f_3\\f_4\end{bmatrix}=\frac{1}{4lk}\begin{bmatrix}lk&k&-k&l\\ lk&k&k&-l\\ lk&-k&k&l\\lk&-k&-k&-l\end{bmatrix}\begin{bmatrix}f_z\\ \tau_x\\\tau_y\\\tau_z\end{bmatrix}\tag{2.6}</script><p>&emsp;可以看出四旋翼无人机无法提供侧向的机体作用力，需要将期望姿态作为位置控制器的输入以实现三个自由度的位置控制。对于公式(1.6)中的设计的位置控制器，将等式右边计算出来的控制量记作：$\boldsymbol{u}=[u_x,u_y,u_z]^{\mathrm{T}}$，当期望姿态满足如下公式时，根据1.1中的推导，位置控制器能够收敛：</p><script type="math/tex; mode=display">R^*\begin{bmatrix}0\\ 0\\ f_z\end{bmatrix}=\begin{bmatrix}u_x\\ u_y\\ u_z\end{bmatrix}\tag{2.7}</script><p>其中$R^{\star}$为期望姿态。<br>定义$R^{\star}=[\boldsymbol{n}_1,\boldsymbol{n}_2,\boldsymbol{n}_3]$，其中 $\boldsymbol{n}_i$为三维列向量，则根据(2.8)可以解得期望的姿态和升力：</p><script type="math/tex; mode=display">\begin{aligned}&f_z=||\boldsymbol{u}||\\&\boldsymbol{n}_1=\boldsymbol{n}_2\times\boldsymbol{n}_3\\&\boldsymbol{n}_2=\frac{\boldsymbol{n}_3\times\boldsymbol{h}}{||\boldsymbol{n}_3\times\boldsymbol{h}||}\\&\boldsymbol{n}_3=\frac{\boldsymbol{u}}{||\boldsymbol{u}||}\end{aligned} \tag{2.8}</script><p>其中$\boldsymbol{h}=[\mathrm{cos}{\psi}^{\star},\mathrm{cos}{\psi}^{\star},0]^{\mathrm{T}}$，$\psi^{\star}$为无人机的期望偏航角。最后设计姿态控制器跟踪$R^{\star}$就实现四旋翼无人机的控制了，可以参考 <a href="https://wuyangning.top/2022/11/03/y2022m11/%E5%A7%BF%E6%80%81%E6%8E%A7%E5%88%B6/">刚体姿态控制</a>。四旋翼无人机的控制流程图大致如下：</p><p><img src="/img/y2023m01/2-2.png" alt></p><p>ps：这种位置和姿态串级控制的这种方式，建立在内外环分离假设的基础上，即假设姿态环是0误差跟踪的。因此在应用中，要求内环的响应速度要高于外环。此外，由于外环的控制输入是内环的跟踪期望，因而内环的控制中会涉及高阶的状态量(姿态的跟踪需要$R^{\star}$和$\boldsymbol{\omega}^{\star}$，位置控制器中$R^*$与$\dot{\boldsymbol{e}}$相关，因此$\boldsymbol{\omega}^{\star}$会与$\ddot{\boldsymbol{e}}$有关)，如果使用差分来求取完整的内环期望轨迹$R^{\star}$和$\boldsymbol{\omega}^{\star}$，会导致误差和噪声被放大。在实现中可以省略内环期望的高阶项或者使用滤波器平滑外环的控制输入，即假设内环期望信号的高阶量是慢变或有界的。<br>&emsp;由位置控制器和姿态控制器可以求出无人机控制所需的机体升力和力矩$f_z,\tau_x,\tau_y,\tau_z$，再代入公式(2.6)可以求得四个旋翼的升力。</p><h2><span id="22-三旋翼tri-copter">2.2 三旋翼(Tri-copter)</span></h2><p><img src="/img/y2023m01/2-3.png" alt></p><p>&emsp;三个旋翼产生的升力和反作用力矩方向如图所示，3号旋翼为倾转旋翼，倾转角度为$\theta$，机架为正三角形布置，机臂长为$l$。与四旋翼的步骤一样，先推导混控矩阵，可以列出：</p><script type="math/tex; mode=display">\begin{aligned}&R_1=R_2=\mathrm{diag}(1,1,1)\\&R_3=\mathrm{Rot}_x(\theta)=\begin{bmatrix}1 & 0 &0 \\ 0 & \mathrm{cos}\theta &-\mathrm{sin}\theta \\ 0 & \mathrm{sin}\theta& \mathrm{cos}\theta\end{bmatrix}\end{aligned}\tag{2.9}</script><script type="math/tex; mode=display">\begin{aligned}&F_1=R_1[0,0,f_1]^{\mathrm{T}},&M_1&=R_1[0,0,kf_1]^{\mathrm{T}}\\&F_2=R_2[0,0,f_2]^{\mathrm{T}},&M_2&=R_2[0,0,kf_2]^{\mathrm{T}}\\&F_3=R_3[0,0,f_3]^{\mathrm{T}},&M_3&=R_3[0,0,kf_3]^{\mathrm{T}}\\\end{aligned}\tag{2.10}</script><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{r}_1=\frac{1}{2}[l,\sqrt{3}l,0]^{\mathrm{T}}\\&\boldsymbol{r}_2=\frac{1}{2}[l,-\sqrt{3}l,0]^{\mathrm{T}}\\&\boldsymbol{r}_3=[-l,0,0]^{\mathrm{T}}\end{aligned}\tag{2.11}</script><p>根据公式(1.12)和(1.13)可以得到：</p><script type="math/tex; mode=display">\boldsymbol{f}_b=\begin{bmatrix}0\\ -f_3\mathrm{sin}\theta\\ f_1+f_2+f_3\mathrm{cos}\theta\end{bmatrix},~\boldsymbol{\tau}_b=\begin{bmatrix}\frac{\sqrt{3}}{2}lf_1 - \frac{\sqrt{3}}{2}lf_2\\ lf_3\mathrm{cos}\theta - \frac{1}{2}lf_1 - \frac{1}{2}lf_2 - kf_3\mathrm{sin}\theta\\\ kf_3\mathrm{cos}\theta + kf_1 + kf_2 + lf_3\mathrm{sin}\theta\end{bmatrix}\tag{2.12}</script><p>可以看出无人机受力与待求的$f_1,f_2,f_3,\theta$之间不是线型关系，可以先将$f_3\mathrm{cos}\theta$和$f_3\mathrm{sin}\theta$作为待求量，将上式写成矩阵形式：</p><script type="math/tex; mode=display">\begin{bmatrix}f_y\\ f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}=\begin{bmatrix}0&0&0&-1\\ 1&1&1&0\\ \frac{\sqrt{3}}{2}l&-\frac{\sqrt{3}}{2}l&0&0\\-\frac{1}{2}l&-\frac{1}{2}l&l&-k\\k&k&k&l\end{bmatrix}\begin{bmatrix}f_1\\ f_2\\f_3\mathrm{cos}\theta\\f_3\mathrm{sin}\theta\end{bmatrix}\tag{2.13}</script><p>考虑到Tri-copter无人机只有4个可以驱动的量，因此$f_y=-f_3\mathrm{sin}\theta$为附加作用力，考虑到倾转电机工作的角度通常不会太大，因此这里假设$f_y\approx0$。解公式(2.13)可以得到：</p><script type="math/tex; mode=display">\begin{bmatrix}f_1\\ f_2\\f_3\mathrm{cos}\theta\\f_3\mathrm{sin}\theta\end{bmatrix}=\frac{1}{3l^2}\begin{bmatrix}k^{2} + l^{2} & \sqrt{3}l & - l & -k\\k^{2} + l^{2} & - \sqrt{3}l & -l & -k\\-2k^{2} + l^{2} & 0 & 2l & 2k\\-3kl & 0 & 0 & 3l\end{bmatrix}\begin{bmatrix}f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}\tag{2.14}</script><p>&emsp;得到混控矩阵后，可以看出Tri-copter的位置和姿态控制器的输入与四旋翼是一样的，其余步骤代入四旋翼的控制流程即可。</p><h2><span id="23-倾转双旋翼bi-copter">2.3 倾转双旋翼(Bi-copter)</span></h2><p><img src="/img/y2023m01/2-4.png" alt></p><p>&emsp;Bi-copter的两个旋翼产生的机体作用力和力矩如图所示，倾转电机的角度分别为$\theta_1$和$\theta_2$，单机臂长为$l_y$，旋翼距离质心的高度为$l_z$，可以列出：</p><script type="math/tex; mode=display">\begin{aligned}&R_1=\mathrm{Rot}_z(\frac{\pi}{2})\mathrm{Rot}_x(\theta_1)\\&R_2=\mathrm{Rot}_z(\frac{\pi}{2})\mathrm{Rot}_x(\theta_2)\end{aligned}\tag{2.15}</script><script type="math/tex; mode=display">\begin{aligned}&F_1=R_1[0,0,f_1]^{\mathrm{T}},&M_1&=R_1[0,0,kf_1]^{\mathrm{T}}\\&F_2=R_2[0,0,f_2]^{\mathrm{T}},&M_2&=R_2[0,0,-kf_2]^{\mathrm{T}}\\\end{aligned}\tag{2.16}</script><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{r}_1=[0,l_y,l_z]^{\mathrm{T}}\\&\boldsymbol{r}_2=[0,-l_y,l_z]^{\mathrm{T}}\\\end{aligned}\tag{2.17}</script><p>根据公式(1.12)和(1.13)可以得到：</p><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{f}_b=\begin{bmatrix}f_1\mathrm{sin}\theta_1 + f_2\mathrm{sin}\theta_2\\ 0\\ f_1\mathrm{cos}\theta_1 + f_2\mathrm{cos}\theta_2\end{bmatrix},\\&\boldsymbol{\tau}_b=\begin{bmatrix}l_yf_1\mathrm{cos}\theta_1 - l_yf_2\mathrm{cos}\theta_2 + kf_1\mathrm{sin}\theta_1 - kf_2\mathrm{sin}\theta_2\\ l_zf_1\mathrm{sin}\theta_1 + l_zf_2\mathrm{sin}\theta_2\\kf_1\mathrm{cos}\theta_1 - kf_2\mathrm{cos}\theta_2 - l_yf_1\mathrm{sin}\theta_1 + l_yf_2\mathrm{sin}\theta_2\end{bmatrix}\end{aligned}\tag{2.18}</script><p>写成矩阵形式：</p><script type="math/tex; mode=display">\begin{bmatrix}f_x\\ f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}=\begin{bmatrix}0&1&0&1\\ 1&0&1&0\\ l_y&k&-l_y&-k\\ 0&l_z&0&l_z\\k&-l_y&-k&l_y\end{bmatrix}\begin{bmatrix}f_1\mathrm{cos}\theta_1\\ f_1\mathrm{sin}\theta_1\\ f_2\mathrm{cos}\theta_2\\f_2\mathrm{sin}\theta_2\\ \end{bmatrix}\tag{2.19}</script><p>$f_x=f_1\mathrm{sin}\theta_1+f_2\mathrm{sin}\theta_2$为附加作用力，与tricopter类似，这里假设$f_x\approx0$。假设$l_z\neq0$(如果$l_z=0$将无法提供$y$方向的力矩)，解公式(2.19)可以得到的：</p><script type="math/tex; mode=display">\begin{bmatrix}f_1\mathrm{cos}\theta_1\\ f_1\mathrm{sin}\theta_1\\ f_2\mathrm{cos}\theta_2\\f_2\mathrm{sin}\theta_2\\ \end{bmatrix}=\frac{1}{2}\begin{bmatrix}1 & \frac{l_y}{k^{2} + l_y^{2}} & 0 & \frac{k}{k^{2} + l_y^{2}}\\0 & \frac{k}{k^{2} + l_y^{2}} & \frac{1}{l_z} & - \frac{l_y}{k^{2} + l_y^{2}}\\1 & - \frac{l_y}{k^{2} + l_y^{2}} & 0 & - \frac{k}{k^{2} + l_y^{2}}\\0 & - \frac{k}{k^{2} + l_y^{2}} & \frac{1}{l_z} & \frac{l_y}{k^{2} + l_y^{2}}\end{bmatrix}\begin{bmatrix}f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}\tag{2.20}</script><p>&emsp;其余步骤参考四旋翼无人机的控制流程。</p><h2><span id="24-矢量共轴双旋翼">2.4 矢量共轴双旋翼</span></h2><p><img src="/img/y2023m01/2-5.png" alt></p><p>矢量共轴双旋翼的机构设计如图所示，可以列出：</p><script type="math/tex; mode=display">\begin{aligned}R_1=\mathrm{Rot}_x(\theta_1)\\ R_2=\mathrm{Rot}_y(\theta_2)\end{aligned}\tag{2.21}</script><script type="math/tex; mode=display">\begin{aligned}&F_1=R_1[0,0,f_1]^{\mathrm{T}},&M_1&=R_1[0,0,kf_1]^{\mathrm{T}}\\&F_2=R_2[0,0,f_2]^{\mathrm{T}},&M_2&=R_2[0,0,-kf_2]^{\mathrm{T}}\\\end{aligned}\tag{2.22}</script><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{r}_1=[0,0,l]^{\mathrm{T}}\\&\boldsymbol{r}_2=[0,0,-l]^{\mathrm{T}}\\\end{aligned}\tag{2.23}</script><p>可以得到：</p><script type="math/tex; mode=display">\boldsymbol{f}_b=\begin{bmatrix}f_2\mathrm{sin}\theta_2\\ -f_1\mathrm{sin}\theta_1\\ f_1\mathrm{cos}\theta_1 + f_2\mathrm{cos}\theta_2\end{bmatrix},\boldsymbol{\tau}_b=\begin{bmatrix}lf_1\mathrm{sin}\theta_1 - kf_2\mathrm{sin}\theta_2\\ -kf_1\mathrm{sin}\theta_1 - lf_2\mathrm{sin}\theta_2\\kf_1\mathrm{cos}\theta_1 - kf_2\mathrm{cos}\theta_2\end{bmatrix}\tag{2.24}</script><p>写成矩阵形式：</p><script type="math/tex; mode=display">\begin{bmatrix}f_x\\f_y\\ f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}=\begin{bmatrix}0&0&0&1\\ 0&-1&0&0\\ 1&0&1&0\\ 0&l&0&-k\\0&-k&0&-l\\k&0&-k&0&\end{bmatrix}\begin{bmatrix}f_1\mathrm{cos}\theta_1\\ f_1\mathrm{sin}\theta_1\\ f_2\mathrm{cos}\theta_2\\ f_2\mathrm{sin}\theta_2\end{bmatrix}\tag{2.25}</script><p>将$f_x$和$f_y$为附加作用力，与tricopter类似，这里假设$f_x,f_y\approx0$，解上式可以得到：</p><script type="math/tex; mode=display">\begin{bmatrix}f_1\mathrm{cos}\theta_1\\ f_1\mathrm{sin}\theta_1\\ f_2\mathrm{cos}\theta_2\\ f_2\mathrm{sin}\theta_2\end{bmatrix}=\begin{bmatrix}\frac{1}{2} & 0 & 0 & \frac{1}{2 k}\\0 & \frac{l}{k^{2} + l^{2}} & - \frac{k}{k^{2} + l^{2}} & 0\\\frac{1}{2} & 0 & 0 & - \frac{1}{2 k}\\0 & -\frac{k}{k^{2} +l^{2}} & -\frac{l}{k^{2} + l^{2}} & 0\end{bmatrix}\begin{bmatrix} f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}\tag{2.26}</script><p>&emsp;其余步骤参考四旋翼无人机的控制流程。</p><h1><span id="3-全驱动无人机">3 全驱动无人机</span></h1><h2><span id="31-全驱动倾转三旋翼">3.1 全驱动倾转三旋翼</span></h2><p><img src="/img/y2023m01/3-1.png" alt></p><p>&emsp;三个旋翼的坐标系定义如图所示，三个旋翼都为倾转旋翼，倾转角度分别为$\theta_1,\theta_1,\theta_3$，机架为正三角形布置，机臂长为$l$。可以列出：</p><script type="math/tex; mode=display">\begin{aligned}&R_1=\mathrm{Rot}_z(-\frac{2\pi}{3})\mathrm{Rot}_x(\theta_1)\\&R_2=\mathrm{Rot}_z(-\frac{\pi}{3})\mathrm{Rot}_x(\theta_2)\\&R_3=\mathrm{Rot}_x(\theta_3)\end{aligned}\tag{3.1}</script><script type="math/tex; mode=display">\begin{aligned}&F_1=R_1[0,0,f_1]^{\mathrm{T}},&M_1&=R_1[0,0,kf_1]^{\mathrm{T}}\\&F_2=R_2[0,0,f_2]^{\mathrm{T}},&M_2&=R_2[0,0,-kf_2]^{\mathrm{T}}\\&F_3=R_3[0,0,f_3]^{\mathrm{T}},&M_3&=R_3[0,0,kf_3]^{\mathrm{T}}\\\end{aligned}\tag{3.2}</script><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{r}_1=\frac{1}{2}[l,\sqrt{3}l,0]^{\mathrm{T}}\\&\boldsymbol{r}_2=\frac{1}{2}[l,-\sqrt{3}l,0]^{\mathrm{T}}\\&\boldsymbol{r}_3=[-l,0,0]^{\mathrm{T}}\end{aligned}\tag{3.3}</script><p>根据公式(1.12)和(1.13)可以得到：</p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{f}&=\begin{bmatrix}-\frac{\sqrt{3}}{2}f_1\mathrm{sin}\theta_1 - \frac{\sqrt{3}}{2}f_2\mathrm{sin}\theta_2\\ \frac{1}{2}f_1\mathrm{sin}\theta_1 - \frac{1}{2}f_2\mathrm{sin}\theta_2 - f_3\mathrm{sin}\theta_3\\ f_1\mathrm{cos}\theta_1 + f_2\mathrm{cos}\theta_2 + f_3\mathrm{cos}\theta_3\end{bmatrix},\\\boldsymbol{\tau}&=\begin{bmatrix}\frac{\sqrt{3}}{2}lf_1\mathrm{cos}\theta_1 - \frac{\sqrt{3}}{2}lf_2\mathrm{cos}\theta_2 - \frac{\sqrt{3}}{2}kf_1\mathrm{sin}\theta_1 + \frac{\sqrt{3}}{2}kf_2\mathrm{sin}\theta_2\\ -\frac{1}{2}lf_1\mathrm{cos}\theta_1 - \frac{1}{2}lf_2\mathrm{cos}\theta_2 + lf_3\mathrm{cos}\theta_3 + \frac{1}{2}kf_1\mathrm{sin}\theta_1 + \frac{1}{2}kf_2\mathrm{sin}\theta_2 - kf_3\mathrm{sin}\theta_3\\ kf_1\mathrm{cos}\theta_1 - kf_2\mathrm{cos}\theta_2 + kf_3\mathrm{cos}\theta_3 + lf_1\mathrm{sin}\theta_1 - lf_2\mathrm{sin}\theta_2 + lf_3\mathrm{sin}\theta_3\end{bmatrix}\end{aligned}\tag{3.4}</script><p>写成矩阵形式：</p><script type="math/tex; mode=display">\begin{bmatrix}f_x\\f_y\\ f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}=\begin{bmatrix}0&-\frac{\sqrt{3}}{2}&0&-\frac{\sqrt{3}}{2}&0&0\\ 0&\frac{1}{2}&0&-\frac{1}{2}&0&-1\\ 1&0&1&0&1&0\\ \frac{\sqrt{3}}{2}l&-\frac{\sqrt{3}}{2}k&-\frac{\sqrt{3}}{2}l&\frac{\sqrt{3}}{2}k&0&0\\-\frac{1}{2}l&\frac{1}{2}k&-\frac{1}{2}l&\frac{1}{2}k&l&-k\\k&l&-k&-l&k&l\end{bmatrix}\begin{bmatrix}f_1\mathrm{cos}\theta_1\\ f_1\mathrm{sin}\theta_1\\ f_2\mathrm{cos}\theta_2\\f_2\mathrm{sin}\theta_2\\ f_3\mathrm{cos}\theta_3\\f_3\mathrm{sin}\theta_3\\ \end{bmatrix}\tag{3.5}</script><p>对上式求逆(可以使用sympy计算)可以得到：</p><script type="math/tex; mode=display">\begin{bmatrix}f_1\mathrm{cos}\theta_1\\ f_1\mathrm{sin}\theta_1\\ f_2\mathrm{cos}\theta_2\\f_2\mathrm{sin}\theta_2\\ f_3\mathrm{cos}\theta_3\\f_3\mathrm{sin}\theta_3\\ \end{bmatrix}=\frac{1}{8k^2+9l^2}\begin{bmatrix}\frac{- 4 \sqrt{3} k^{3} - 3 \sqrt{3} k l^{2}}{3l} & \frac{4 k^{3} + 5 k l^{2}}{l} & 2 k^{2} + 3 l^{2} & \frac{4 \sqrt{3} k^{2} + 9 \sqrt{3} l^{2}}{3l} & \frac{- 4 k^{2} - 3 l^{2}}{l} & 2k\\\frac{- 10 \sqrt{3} k^{2} - 9 \sqrt{3} l^{2}}{3} & 2 k^{2} + 3 l^{2} & -k l & -2\sqrt{3} k & -2k & 3 l\\-\sqrt{3} k l & - k l & 4 k^{2} + 3 l^{2} & -3 \sqrt{3} l & -3 l & - 4 k\\-2 \sqrt{3} k^{2} - 3 \sqrt{3} l^{2} &-2 k^{2} - 3 l^{2} &k l & 2\sqrt{3} k & 2k & -3 l\\\frac{4\sqrt{3} k^{3} + 6\sqrt{3} k l^{2}}{3l} & \frac{- 4 k^{3} - 4 k l^{2}}{l} & 2 k^{2} + 3 l^{2} & - \frac{4 \sqrt{3} k^{2}}{3l} & \frac{4 k^{2} + 6 l^{2}}{l} & 2k\\-\frac{2\sqrt{3} k^{2}}{3} & -6 k^{2} -6 l^{2} & -k l & -2\sqrt{3} k & -2k &3 l\end{bmatrix}\begin{bmatrix}f_x\\f_y\\ f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}\tag{3.6}</script><p>&emsp;全驱动无人机的自由度是完整的，$\boldsymbol{f}$和$\boldsymbol{\tau}$可以分别作为位置控制器和姿态控制器的控制输入。对于位置控制器，根据公式(1.6)设计$\boldsymbol{f}=MR^{\mathrm{T}}(-k_p\boldsymbol{e}-k_d\dot{\boldsymbol{\boldsymbol{e}}}+g\boldsymbol{e}_3-\boldsymbol{f}_e+\ddot{\boldsymbol{p}}_d) $。对于姿态控制器，可以参考 <a href="https://wuyangning.top/2022/11/03/y2022m11/%E5%A7%BF%E6%80%81%E6%8E%A7%E5%88%B6/">刚体姿态控制</a>。</p><h2><span id="32-全驱动六旋翼">3.2 全驱动六旋翼</span></h2><p><img src="/img/y2023m01/3-2.png" alt></p><p>&emsp;六个固定旋翼的的坐标系定义如图所示，机架为正六边形布局，旋翼倾斜角为45度。可以列出：</p><script type="math/tex; mode=display">\begin{aligned}&R_1=\mathrm{Rot}_z(\frac{\pi}{6})\mathrm{Rot}_x(\frac{\pi}{4})\\&R_2=\mathrm{Rot}_z(-\frac{\pi}{6})\mathrm{Rot}_x(-\frac{\pi}{4})\\&R_3=\mathrm{Rot}_z(\frac{\pi}{2})\mathrm{Rot}_x(-\frac{\pi}{4})\\&R_4=\mathrm{Rot}_z(\frac{\pi}{2})\mathrm{Rot}_x(-\frac{\pi}{4})\\&R_5=\mathrm{Rot}_z(-\frac{\pi}{6})\mathrm{Rot}_x(-\frac{\pi}{4})\\&R_6=\mathrm{Rot}_z(\frac{\pi}{6})\mathrm{Rot}_x(\frac{\pi}{4})\\\end{aligned}\tag{3.7}</script><script type="math/tex; mode=display">\begin{aligned}&F_1=R_1[0,0,f_1]^{\mathrm{T}},&M_1&=R_1[0,0,kf_1]^{\mathrm{T}}\\&F_2=R_2[0,0,f_2]^{\mathrm{T}},&M_2&=R_2[0,0,kf_2]^{\mathrm{T}}\\&F_3=R_3[0,0,f_3]^{\mathrm{T}},&M_3&=R_3[0,0,kf_3]^{\mathrm{T}}\\&F_4=R_4[0,0,f_4]^{\mathrm{T}},&M_4&=R_4[0,0,kf_4]^{\mathrm{T}}\\&F_5=R_5[0,0,f_5]^{\mathrm{T}},&M_5&=R_5[0,0,kf_5]^{\mathrm{T}}\\&F_6=R_6[0,0,f_6]^{\mathrm{T}},&M_6&=R_6[0,0,kf_6]^{\mathrm{T}}\\\end{aligned}\tag{3.8}</script><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{r}_1=\frac{l}{2}[\sqrt{3},1,0]^{\mathrm{T}}\\&\boldsymbol{r}_2=\frac{l}{2}[\sqrt{3},-1,0]^{\mathrm{T}}\\&\boldsymbol{r}_3=l[0,1,0]^{\mathrm{T}}\\&\boldsymbol{r}_4=l[0,-1,0]^{\mathrm{T}}\\&\boldsymbol{r}_5=\frac{l}{2}[-\sqrt{3},1,0]^{\mathrm{T}}\\&\boldsymbol{r}_6=\frac{l}{2}[-\sqrt{3},-1,0]^{\mathrm{T}}\end{aligned}\tag{3.9}</script><p>根据公式(1.12)和(1.13)可以得到：</p><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{f}=\begin{bmatrix}\frac{\sqrt{2}}{4}&&\\&\frac{\sqrt{6}}{4}&\\&&\frac{\sqrt{2}}{2}\end{bmatrix}\begin{bmatrix}f_1+f_2-2f_3-2f_4+f_5+f_6\\ -f_1+f_2+f_5-f_6\\ f_1+f_2+f_3+f_4+f_5+f_6\end{bmatrix}\\&\boldsymbol{\tau}=\begin{bmatrix}\frac{\sqrt{2}}{4}&&\\&\frac{\sqrt{6}}{4}&\\&&\frac{\sqrt{2}}{2}\end{bmatrix}\begin{bmatrix}(l+k)f_1-(l-k)f_2+2(l-k)f_3-2(l+k)f_4+(l+k)f_5-(l-k)f_6\\ -(l+k)f_1-(l-k)f_2+(l+k)f_5+ (l-k)f_6\\ -(l-k)f_1+(l+k)f_2+(l+k)f_3-(l-k)f_4-(l-k)f_5+(l+k)f_6\end{bmatrix}\\\end{aligned}\tag{3.10}</script><p>写成矩阵形式：</p><script type="math/tex; mode=display">\begin{bmatrix}f_x\\f_y\\ f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}=\begin{bmatrix}\frac{\sqrt{2}}{4}&\frac{\sqrt{2}}{4}&-\frac{\sqrt{2}}{2}&-\frac{\sqrt{2}}{2}&\frac{\sqrt{2}}{4}&\frac{\sqrt{2}}{4}\\ -\frac{\sqrt{6}}{4}&\frac{\sqrt{6}}{4}&0&0&\frac{\sqrt{6}}{4}&-\frac{\sqrt{6}}{4}\\ \frac{\sqrt{2}}{2}&\frac{\sqrt{2}}{2}&\frac{\sqrt{2}}{2}&\frac{\sqrt{2}}{2}&\frac{\sqrt{2}}{2}&\frac{\sqrt{2}}{2}\\ \frac{\sqrt{2}}{4}(l+k)&-\frac{\sqrt{2}}{4}(l-k)&\frac{\sqrt{2}}{2}(l-k)&-\frac{\sqrt{2}}{2}(l+k)&\frac{\sqrt{2}}{4}(l+k)&-\frac{\sqrt{2}}{4}(l-k)\\-\frac{\sqrt{6}}{4}(l+k)&-\frac{\sqrt{6}}{4}(l-k)&0&0&\frac{\sqrt{6}}{4}(l+k)&\frac{\sqrt{6}}{4}(l-k)\\-\frac{\sqrt{2}}{2}(l-k)&\frac{\sqrt{2}}{2}(l+k)&\frac{\sqrt{2}}{2}(l+k)&-\frac{\sqrt{2}}{2}(l-k)&-\frac{\sqrt{2}}{2}(l-k)&\frac{\sqrt{2}}{2}(l+k)\end{bmatrix}\begin{bmatrix}f_1\\ f_2\\ f_3\\f_4\\ f_5\\f_6\\ \end{bmatrix}\tag{3.11}</script><p>对公式(3.11)求逆可以得到：</p><script type="math/tex; mode=display">\begin{bmatrix}f_1\\ f_2\\ f_3\\f_4\\ f_5\\f_6\\ \end{bmatrix}=\frac{\sqrt{2}}{6l}\begin{bmatrix}l-k&-\sqrt{3}(l-k)&l+k&1&-\sqrt{3}&-1\\l+k&\sqrt{3}(l+k)&l-k&-1&-\sqrt{3}&1\\-2(l+k)&0&l-k&2&0&1\\-2(l-k)&0&l+k&-2&0&-1\\l-k&\sqrt{3}(l-k)&l+k&1&\sqrt{3}&-1\\l+k&-\sqrt{3}(l+k)&l-k&-1&\sqrt{3}&1\end{bmatrix}\begin{bmatrix}f_x\\f_y\\ f_z\\\tau_x\\\tau_y\\\tau_z\end{bmatrix}\tag{3.12}</script><p>&emsp;与全驱动倾转三旋翼类似，全驱动三旋翼的自由度是完整的，控制器的设计可参考3.1中的步骤。</p><h1><span id="4-补充">4 补充</span></h1><p>&emsp;前面讨论了不同构型的无人机的基本控制，中间有一些可能需要解决的问题比较复杂，没有进行讨论，在这里列出：</p><ul><li><strong>混控关系的可逆性</strong>：这里以常见的平面六旋翼无人机为例，六旋翼无人机有$6$个可以驱动的旋翼，推导混控矩阵时会发现混控矩阵是一个$6\times6$的方阵，但是这个方阵的秩为$4$，是不可逆的，也就是说平面六旋翼无人机只有4个可以独立驱动的自由度。因此，如果想要设计一个全驱动的无人机，如何优化无人机的旋翼布局保证混控矩阵的可逆性，是一个需要考虑的问题。如果只考虑平面六旋翼4个可以独立驱动的自由度，以4个驱动力或力矩来求取6个旋翼的升力，会发现有无穷多个解，也就是说，如果无人机只驱动这四个自由度，旋翼的数量是冗余的。对于冗余的自由度，如何充分利用也是一个需要考虑的问题，例如如何用冗余的自由度应对旋翼故障，或是将部分控制任务放在0空间中，实现子任务和优先级控制。</li><li><strong>奇异性</strong>：考虑一个完整驱动的无人机，虽然旋翼能够提供机体坐标系下的完整驱动力和力矩，但是可能存在一种情况：无人机在某个姿态下所提供的最大升力无法克服重力，使得无人机无法到达所有的姿态空间。因此，如何优化旋翼布局，避免这种奇异的出现或是最大化可到达的姿态空间是一个需要考虑的问题。此外，对于多组倾斜旋翼构成的无人机而言，旋翼的产生的气流有比较大的交叉和重叠，效率是比较低的，如何在保证驱动自由度的情况下，如何通过旋翼布局最大化驱动效率也是一个问题。</li><li><strong>抗扰动控制</strong>：文中的控制器并未对扰动进行补偿，当系统中存在有界扰动时，会有较大的跟踪静差。可以设计自适应率，或者在控制器中加入积分环节进行补偿。</li><li><strong>倾转旋翼的动力学</strong>对于带有倾转旋翼的无人机，应其动力学该是一个多体动力学模型，当简化成单一刚体进行建模和控制，会导致很多未建模的不确定性，特别是旋翼的质量惯量、空气动力学不可忽略，倾转电机的响应速度有限的情况下，简化的建模容易导致调参困难，运动性能无法调节地较为激进，甚至控制失效等问题。</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>姿态控制</title>
      <link href="/2022/11/03/y2022m11/%E5%A7%BF%E6%80%81%E6%8E%A7%E5%88%B6/"/>
      <url>/2022/11/03/y2022m11/%E5%A7%BF%E6%80%81%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p><strong>摘要：讨论不同姿态表示方法下的姿态运动学和动力学控制。包含的姿态控制方法有：基于欧拉角的控制、基于四元数的控制、基于李群李代数的控制(几何控制)。</strong><br><span id="more"></span></p><h1><span id="1-姿态运动学控制">1 姿态运动学控制</span></h1><p>&emsp;这里的运动学考虑姿态运动的一阶模型，通过设定期望的角速度让刚体到达期望的姿态。通过对简单的运动学控制效果进行比较，能够直观地展示不同姿态表示法的特点。</p><h2><span id="11-基于欧拉角的运动学控制">1.1 基于欧拉角的运动学控制</span></h2><p>&emsp;使用绕机体坐标系旋转的z-y-x欧拉角$\boldsymbol{\Phi}=[\phi,\theta,\psi]^{\mathrm{T}}$来表示姿态，系统的输入为刚体坐标系下的角速度$\boldsymbol{\omega}_b$，采用欧拉角表示的姿态运动学模型可以写作：</p><script type="math/tex; mode=display">\begin{align}&\dot{\boldsymbol{\Phi}}=T(\boldsymbol{\Phi})\boldsymbol{\boldsymbol{\omega}}_b\\\end{align}\tag{1.1}</script><p>其中</p><script type="math/tex; mode=display">T(\boldsymbol{\Phi})=\begin{bmatrix}1 & \mathrm{sin}\phi \mathrm{tan}\theta&\mathrm{cos}\phi\mathrm{tan}\theta\\0 & \mathrm{cos}\phi & -\mathrm{sin}\phi\\0 & \mathrm{sin}\phi \mathrm{sec}\theta  & \mathrm{cos}\phi \mathrm{sec}\theta\end{bmatrix} \tag{1.2}</script><p>当$\theta\neq\pm \pi/2$时，$T(\boldsymbol{\Phi})$的逆为：</p><script type="math/tex; mode=display">T^{-1}(\boldsymbol{\Phi})=\begin{bmatrix}1 & 0&-\mathrm{sin}\theta\\0 & \mathrm{cos}\phi & \mathrm{sin}\phi\mathrm{cos}\theta\\0 & -\mathrm{sin}\phi & \mathrm{cos}\phi \mathrm{cos}\theta\end{bmatrix}\tag{1.3}</script><p>&emsp;由于欧拉角无法直接表示$SO(3)$空间中的旋转误差，因此采用线性误差来表示旋转误差，定义期望的姿态为$\boldsymbol{\Phi}_d$，这里考虑姿态的定点控制，则$\dot{\boldsymbol{\Phi}}_d=0$。定义欧拉角的误差为：</p><script type="math/tex; mode=display">\boldsymbol{\Phi}_e=\boldsymbol{\Phi}-\boldsymbol{\Phi}_d \tag{1.4}</script><p>将公式(1.1)改写作关于欧拉角误差的运动学模型：</p><script type="math/tex; mode=display">\dot{\boldsymbol{\Phi}}_e=\dot{\boldsymbol{\Phi}}-\dot{\boldsymbol{\Phi}}_d=T(\boldsymbol{\Phi})\boldsymbol{\boldsymbol{\omega}}_b \tag{1.5}</script><p>设定控制输入$\boldsymbol{\omega}_b$为：</p><script type="math/tex; mode=display">\boldsymbol{\omega}_b=-T^{-1}(\boldsymbol{\Phi})K\boldsymbol{\Phi}_e \tag{1.6}</script><p>其中$K&gt;0\in\mathbb{R}^{3\times3}$为控制增益，是正定的对角矩阵。特别地，如果设定三个旋转方向的增益都相同，$K$可以使用$k\in\mathbb{R}$代替。<br>&emsp;将(1.6)代入(1.1)中可以得到:</p><script type="math/tex; mode=display">\dot{\boldsymbol{\Phi}}_e+K\boldsymbol{\Phi}_e=0 \tag{1.7}</script><p>解上述微分方程可知，当$t\rightarrow \infty$时，$\boldsymbol{\Phi}_e$以指数误差收敛到$0$，即刚体的姿态最后能收敛到期望姿态。</p><p><strong>奇异点和线性误差导致的问题</strong><br>&emsp;由于欧拉角存在万向节死锁问题，且欧拉角误差范数在$SO(3)$并不是两个姿态之间的最短路径，因而基于欧拉角的控制会有以下两个问题。</p><ol><li>控制器设计基于$\theta\neq\pm \pi/2$的假设。$\theta=\pm \pi/2$是奇异位置，当姿态无限接近$\theta\neq\pm \pi/2$时，一个小的旋转变化就可能导致欧拉角数值出现明显的变化，容易导致数值计算的不稳定。</li><li>欧拉角的线性误差在$SO(3)$空间中表示的不是最短路径，因此姿态的收敛路径在$SO(3)$空间也不是最短的，并且越接近奇异位置收敛路径与最短路径差的越多。</li></ol><h2><span id="12-基于四元数的运动学控制">1.2 基于四元数的运动学控制</span></h2><p>&emsp;定义刚体姿态的四元数为$\boldsymbol{q}=[s,\boldsymbol{v}]^{\mathrm{T}}$，期望姿态的四元数为$\boldsymbol{q}_d=[s_d,\boldsymbol{v}_d]^{\mathrm{T}}$。考虑姿态的定点控制，则$\dot{\boldsymbol{q}}_d=0$。$\mathbb{S}^3$空间中的旋转误差可以使用四元数乘法表示：</p><script type="math/tex; mode=display">\boldsymbol{q}_e=\bar{\boldsymbol{q}}_d\otimes\boldsymbol{q} \tag{1.8}</script><p>其中$\boldsymbol{q}_e=[s_e,\boldsymbol{v}_e]^{\mathrm{T}}$为旋转的四元数误差。这一误差的范数表示了当前姿态到期望姿态在$\mathbb{S}^3$或$SO(3)$空间中的最短路径。当$\boldsymbol{q}_e\rightarrow[1,0,0,0]^{\mathrm{T}}$时，表明目标姿态和期望姿态重合。<br>&emsp;对公式(8)求导：</p><script type="math/tex; mode=display">\begin{aligned}\dot{\boldsymbol{q}}_e=&\dot{\bar{\boldsymbol{q}}}_d\otimes\boldsymbol{q}+\bar{\boldsymbol{q}}_d\otimes\dot{\boldsymbol{q}}\\=&\frac{1}{2}\bar{\boldsymbol{q}}_d\otimes\boldsymbol{q}\otimes\begin{bmatrix}0\\\boldsymbol{\omega}_b\end{bmatrix}\\=&\frac{1}{2}\boldsymbol{q}_e\otimes\begin{bmatrix}0\\\boldsymbol{\omega}_b\end{bmatrix}\end{aligned} \tag{1.9}</script><p>将公式(1.8)展开可以得到：</p><script type="math/tex; mode=display">\begin{align}&\dot{s}_e=-\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}\boldsymbol{\omega}_b \tag{1.10}\\&\dot{\boldsymbol{v}}_e=\frac{1}{2}(s_e\boldsymbol{\omega}_b+\boldsymbol{v}_e\times\boldsymbol{\omega}_b) \tag{1.11}\\ \end{align}</script><p>四元数本身有一个单位范数的约束，因此让$\boldsymbol{v}_e$收敛到0的同时$s_e$也会收敛到1。容易想到将控制器$\boldsymbol{\omega}_b$设计为：$\boldsymbol{\omega}_b=-\frac{2}{s_e}K\boldsymbol{v}_e$，这样公式(11)就可以改写为$\dot{\boldsymbol{v}}_e+K\boldsymbol{v}_e=0$的形式。但是$s_e$的值可能为0的，因此这么设计是不可行的。<br>&emsp;考虑控制器为：</p><script type="math/tex; mode=display">\boldsymbol{\omega}_b=-2K\boldsymbol{v}_e\tag{1.12}</script><p>其中$K$为对角矩阵，则公式(1.10)和(1.11)可以改写为：</p><script type="math/tex; mode=display">\begin{align}&\dot{s}_e=\boldsymbol{v}_e^{\mathrm{T}}K\boldsymbol{v}_e \tag{1.13}\\&\dot{\boldsymbol{v}}_e=-s_eK\boldsymbol{v}_e\tag{1.14}\end{align}</script><p>其中$K&gt;0\in\mathbb{R}^{3\times3}$为控制增益，是正定的对角矩阵。公式(1.13)中存在一个$s_e$，如果$s_e$是负值，仅从公式看，公式(13)是不收敛的。不过因为$s_e$和$\boldsymbol{v}_e$是相互关联的变量，这种固定一个变量去分析另一个变量本身就是不可行的。因此，这里使用李亚普诺夫方法进行分析。定义李雅普诺夫函数为：</p><script type="math/tex; mode=display">V=\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}\boldsymbol{v}_e+\frac{1}{2}(1-s_e)^2>0 \tag{1.15}</script><p>当$V\rightarrow 0$时，有$\boldsymbol{v}_e\rightarrow 0$和$s_e\rightarrow 1$，刚体收敛到期望姿态。因此如果$\dot{V}$是负定的，就可以证明控制器是收敛的。对公式(1.15)求导，并将(1.13)和(1.14)代入，可得：</p><script type="math/tex; mode=display">\begin{aligned}\dot{V}=&\boldsymbol{v}_e^{\mathrm{T}}\dot{\boldsymbol{v}}_e-(1-s_e)\dot{s}_e\\=&-s_e\boldsymbol{v}_e^{\mathrm{T}}K\boldsymbol{v}_e-(1-s_e)\boldsymbol{v}_e^{\mathrm{T}}K\boldsymbol{v}_e\\=&-\boldsymbol{v}_e^{\mathrm{T}}K\boldsymbol{v}_e \le 0\\\end{aligned}\tag{1.16}</script><p>由于$V$的下界是0，$\dot{V}\le0$，并且：当且仅当$\boldsymbol{v}_e=0$时$\dot{V}=0$，因此当$t \rightarrow \infty$时，$\boldsymbol{v}_e\rightarrow 0$。(这一结论具体可以参考拉塞尔不变性原理)</p><p><strong>双倍覆盖导致的问题</strong><br>&emsp;根据四元数的定义可知，四元数是双倍覆盖的，即四元数$\boldsymbol{q}$和$-\boldsymbol{q}$表示的其实是同一个旋转。这在控制中会导致一些问题：</p><ol><li><p>如果从仿真环境或者传感器解算出的四元数在正负之间反复横跳，会使得(12)中的控制器计算出来的控制量也在正负之间切换，导致控制不能收敛。这一问题可以通过选取四元数的$s$值为正的那一组四元数作为采样数值来解决。</p></li><li><p>(1.12)中给出的控制器和(1.15)中给出的李雅普诺夫函数，证明了四元数误差$\boldsymbol{q}_e$是收敛到$[1,0,0,0]^{\mathrm{T}}$的。如果初始时刻为$s_e=-0.9$，四元数误差会以$s_e: -0.9\rightarrow 0\rightarrow 1$的方式收敛到期望位置。但实际上$s_e:-0.9\rightarrow-1$在旋转空间中才是最短的收敛路径，反映的现象就是姿态会反向绕一个大圈收敛到期望姿态。因此，对于$s_e&gt;0$，希望$s_e\rightarrow 1$，而对于$s_e&lt;0$，希望$s_e\rightarrow -1$，这样刚体的姿态会以最短的那条路径收敛到期望姿态。可以定义如下李雅普诺夫函数</p><script type="math/tex; mode=display">\begin{aligned}V_{+}=&\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}\boldsymbol{v}_e+\frac{1}{2}(1-s_e)^2,~when:s_e>0\\V_{-}=&\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}\boldsymbol{v}_e+\frac{1}{2}(1+s_e)^2,~when:s_e<0 \end{aligned}\tag{1.17}</script><p> 控制器可以改进为：</p><script type="math/tex; mode=display">\boldsymbol{\omega}_b=-2\mathrm{sgn}(s_e)K\boldsymbol{v}_e\tag{1.18}</script><p>其中$\mathrm{sgn}(.)$为符号函数。可以证明(1.18)中的控制器对于$V_+$和$V_-$都有：</p><script type="math/tex; mode=display">\dot{V}_+=\dot{V}_-=-\boldsymbol{v}_e^{\mathrm{T}}K\boldsymbol{v}_e \le 0 \tag{1.19}</script></li></ol><h2><span id="13-基于so3的运动学控制">1.3 基于$SO(3)$的运动学控制</span></h2><p>&emsp;记当前姿态和期望姿态的旋转姿态分别为$R$和$R_d$。考虑定点控制，则$\dot{R}_d=0$。$SO(3)$空间中的旋转误差可以表示为：</p><script type="math/tex; mode=display">R_e=R_d^{\mathrm{T}}R \tag{1.20}</script><p>同时：</p><script type="math/tex; mode=display">\dot{R}_e=R_e\mathrm{sk}(\boldsymbol{\omega}_b) \tag{1.21}</script><p>&emsp;当刚体姿态逼近期望姿态时，$R_e\rightarrow I$，因此可以考虑如下李雅普诺夫函数：</p><script type="math/tex; mode=display">V=\mathrm{tr}(I-R_e)>0 \tag{1.22}</script><p>对公式(1.22)求导：</p><script type="math/tex; mode=display">\dot{V}=-\mathrm{tr}[R_e\mathrm{sk}(\boldsymbol{\omega}_b)] \tag{1.23}</script><p>结合$\mathfrak{so}(3)$的定义，$SO(3)$的切空间是一个反对称矩阵或反对称矩阵对应的$\mathbb{R}^3$向量。记$\boldsymbol{\phi}_e=(R_e-R_e^{\mathrm{T}})^{\vee}$，容易想到将$\boldsymbol{\omega}_b$设计为：</p><script type="math/tex; mode=display">\boldsymbol{\omega}_b=-K\boldsymbol{\phi}_e\tag{1.24}</script><p>则：</p><script type="math/tex; mode=display">\mathrm{sk}(\boldsymbol{\omega}_b)=-K(R_e-R_e^{\mathrm{T}}) \tag{1.25}</script><p>其中$K$为对角矩阵。将(1.25)代入(1.23)中，得到：</p><script type="math/tex; mode=display">\dot{V}=-\mathrm{tr}[K(I-R_eR_e)] \le -k_{\mathrm{min}}\mathrm{tr}(I-R_eR_e)\le 0 \tag{1.26}</script><p>其中$k_{\mathrm{min}}$为$K$矩阵中最小的元素。对于$\dot{V}$，当且仅当$R_e=I$时$\dot{V}=0$，根据拉塞尔不变性原理，当$t\rightarrow 0$时，$R_e\rightarrow I$。</p><h1><span id="2-姿态动力学控制">2 姿态动力学控制</span></h1><p>&emsp;考虑完整的姿态轨迹跟踪问题，对于不同的姿态表示方法，分别使用反步控制来设计姿态控制器。</p><h2><span id="21-基于欧拉角的控制">2.1 基于欧拉角的控制</span></h2><p>&emsp;记当前姿态和期望姿态的欧拉角分别为$\boldsymbol{\Phi}=[\phi,\theta,\psi]^{\mathrm{T}}$和$\boldsymbol{\Phi}=[\phi_d,\theta_d,\psi_d]^{\mathrm{T}}$，欧拉角的线性误差为$\boldsymbol{\Phi}_e=\boldsymbol{\Phi}-\boldsymbol{\Phi}_d $。欧拉角表示的旋转误差的动力学可以写为：</p><script type="math/tex; mode=display">\begin{align}&\dot{\boldsymbol{\Phi}}_e=T(\boldsymbol{\Phi})\boldsymbol{\omega}_b-\dot{\boldsymbol{\Phi}}_d \tag{2.1}\\&\dot{\boldsymbol{\omega}}_b=J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau})\tag{2.2}\end{align}</script><p>其中$J&gt;0$为刚体的惯性矩阵，$\boldsymbol{\tau}$为刚体在自身坐标系下的受力，即待设计的控制量。</p><p>&emsp;选取李雅普诺夫函数为：</p><script type="math/tex; mode=display">V_1=\frac{1}{2}\boldsymbol{\Phi}_e^{\mathrm{T}}\boldsymbol{\Phi}_e \tag{2.3}</script><p>则：</p><script type="math/tex; mode=display">\dot{V}_1=\boldsymbol{\Phi}_e^{\mathrm{T}}\dot{\boldsymbol{\Phi}}_e=\boldsymbol{\Phi}_e^{\mathrm{T}}[T(\boldsymbol{\Phi})\boldsymbol{\omega}_b-\dot{\boldsymbol{\Phi}}_d] \tag{2.4}</script><p>当$T(\boldsymbol{\Phi})\boldsymbol{\omega}_b=-(K_1\boldsymbol{\Phi}_e-\dot{\boldsymbol{\Phi}}_d)$时，有$\dot{V}_1=-\boldsymbol{\Phi}_e^{\mathrm{T}}K_1\boldsymbol{\Phi}_e\le 0$，因此，可以定义虚拟控制量：</p><script type="math/tex; mode=display">\boldsymbol{\Phi}_z=T(\boldsymbol{\Phi})\boldsymbol{\omega}_b+(K_1\boldsymbol{\Phi}_e-\dot{\boldsymbol{\Phi}}_d) \tag{2.5}</script><p>则$\dot{V}_1$可以被改写为：</p><script type="math/tex; mode=display">\dot{V}_1=-\boldsymbol{\Phi}_e^{\mathrm{T}}K_1\boldsymbol{\Phi}_e+\boldsymbol{\Phi}_e^{\mathrm{T}}\boldsymbol{\Phi}_z \tag{2.6}</script><p>对(2.5)求导可以得到$\boldsymbol{\Phi}_z$的导数：</p><script type="math/tex; mode=display">\begin{aligned}\dot{\boldsymbol{\Phi}}_z=&\dot{T}(\boldsymbol{\Phi})\boldsymbol{\omega}_b+T(\boldsymbol{\Phi})\dot{\boldsymbol{\omega}}_b+K_1\dot{\boldsymbol{\Phi}}_e-\ddot{\boldsymbol{\Phi}}_d\\=&T(\boldsymbol{\Phi})J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau})+\dot{T}(\boldsymbol{\Phi})\boldsymbol{\omega}_b\\&+K_1T(\boldsymbol{\Phi})\boldsymbol{\omega}_b-(K_1\dot{\boldsymbol{\Phi}}_d+\ddot{\boldsymbol{\Phi}}_d)\end{aligned}\tag{2.7}</script><p>&emsp;重新选取李雅普诺夫函数：</p><script type="math/tex; mode=display">V_2=V_1+\frac{1}{2}\boldsymbol{\Phi}_z^{\mathrm{T}}\boldsymbol{\Phi}_z  \tag{2.8}</script><p>则：</p><script type="math/tex; mode=display">\begin{aligned}\dot{V}_2=&-\boldsymbol{\Phi}_e^{\mathrm{T}}K_1\boldsymbol{\Phi}_e+\boldsymbol{\Phi}_e^{\mathrm{T}}\boldsymbol{\Phi}_z\\&+\boldsymbol{\Phi}_z^{\mathrm{T}}[T(\boldsymbol{\Phi})J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau})+\dot{T}(\boldsymbol{\Phi})\boldsymbol{\omega}_b\\&~~~~~~~~~~~+K_1T(\boldsymbol{\Phi})\boldsymbol{\omega}_b-(K_1\dot{\boldsymbol{\Phi}}_d+\ddot{\boldsymbol{\Phi}}_d)]\end{aligned} \tag{2.9}</script><p>设计如下控制器：</p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{\tau}=\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b-JT^{-1}(\boldsymbol{\Phi})[&K_2\boldsymbol{\Phi}_z+\dot{T}(\boldsymbol{\Phi})\boldsymbol{\omega}_b+K_1T(\boldsymbol{\Phi})\boldsymbol{\omega}_b\\&+\boldsymbol{\Phi}_e-(K_1\dot{\boldsymbol{\Phi}}_d+\ddot{\boldsymbol{\Phi}}_d)] \end{aligned}\tag{2.10}</script><p>其中$K_1,K_2$为正定对角矩阵。$\dot{T}(\boldsymbol{\Phi})$的展开如下：</p><script type="math/tex; mode=display">\dot{T}(\boldsymbol{\Phi})=\left [\boldsymbol{0},AT(\boldsymbol{\Phi})\boldsymbol{\omega}_b, BT(\boldsymbol{\Phi})\boldsymbol{\omega}_b\right ]\tag{2.11}</script><p>其中：</p><script type="math/tex; mode=display">A=\begin{bmatrix}\mathrm{cos}\phi\mathrm{tan}\theta&\mathrm{sin}\phi\mathrm{sec}^2\theta  &0 \\ -\mathrm{sin}\phi&0  &0 \\ \mathrm{cos}\phi\mathrm{sec}\theta&\mathrm{sin}\phi\mathrm{sec}\theta\mathrm{tan}\theta  &0 \end{bmatrix},B=\begin{bmatrix}-\mathrm{sin}\phi\mathrm{tan}\theta&\mathrm{cos}\phi\mathrm{sec}^2\theta  &0 \\ -\mathrm{cos}\phi&0  &0 \\ -\mathrm{sin}\phi\mathrm{sec}\theta&\mathrm{cos}\phi\mathrm{sec}\theta\mathrm{tan}\theta  &0 \end{bmatrix}</script><p>将(2.10)代入(2.9)可以得到：</p><script type="math/tex; mode=display">\dot{V}_2\le-\boldsymbol{\Phi}_e^{\mathrm{T}}K_1\boldsymbol{\Phi}_e-\boldsymbol{\Phi}_z^{\mathrm{T}}K_2\boldsymbol{\Phi}_z \tag{2.12}</script><p>对于$\dot{V}_2$，当且仅当$\boldsymbol{\Phi}_e=0$和$\boldsymbol{\Phi}_z=0$时$\dot{V}_2=0$，根据拉塞尔不变性原理，当$t\rightarrow \infty$时，$\boldsymbol{\Phi}_e\rightarrow 0$和$\boldsymbol{\Phi}_z \rightarrow 0$。</p><h2><span id="22-基于四元数的控制">2.2 基于四元数的控制</span></h2><p>&emsp;定义刚体姿态的四元数为$\boldsymbol{q}=[s,\boldsymbol{v}]^{\mathrm{T}}$，期望姿态的四元数为$\boldsymbol{q}_d=[s_d,\boldsymbol{v}_d]^{\mathrm{T}}$，四元数误差为$\boldsymbol{q}_e=\bar{\boldsymbol{q}}_d\otimes\boldsymbol{q}=[s_e,\boldsymbol{v}_e]^{\mathrm{T}}$。对$\boldsymbol{q}_d\boldsymbol{q}_e=\boldsymbol{q}$两边同时求导，可以得到：</p><script type="math/tex; mode=display">\dot{\boldsymbol{q}}_e=\frac{1}{2}\boldsymbol{q}_e\otimes\begin{bmatrix}0\\\boldsymbol{\omega}_b\end{bmatrix}-\frac{1}{2}\begin{bmatrix}0\\\boldsymbol{\omega}_d\end{bmatrix}\otimes\boldsymbol{q}_e\tag{2.13}</script><p>其中$\boldsymbol{\omega}_d$为期望的角速度。将(2.13)展开，四元数表示的姿态动力学可以写作：</p><script type="math/tex; mode=display">\begin{align}&\dot{s}_e=-\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}(\boldsymbol{\omega}_b-\boldsymbol{\omega}_d) \tag{2.14}\\&\dot{\boldsymbol{v}}_e=\frac{1}{2}[s_e(\boldsymbol{\omega}_b-\boldsymbol{\omega}_d)+\boldsymbol{v}_e\times(\boldsymbol{\omega}_b+\boldsymbol{\omega}_d)] \tag{2.15}\\ &\dot{\boldsymbol{\omega}}_b=J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau})\tag{2.16}\end{align}</script><p>&emsp;选取李雅普诺夫函数为：</p><script type="math/tex; mode=display">V_1=\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}\boldsymbol{v}_e+\frac{1}{2}(1-s_e)^2\tag{2.17}</script><p>则(这里利用了向量混合积的性质)：</p><script type="math/tex; mode=display">\begin{aligned}\dot{V}_1=&\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}[s_e(\boldsymbol{\omega}_b-\boldsymbol{\omega}_d)+\boldsymbol{v}_e\times(\boldsymbol{\omega}_b+\boldsymbol{\omega}_d)]-(1-s_e)\dot{s}_e\\=&\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}[s_e(\boldsymbol{\omega}_b-\boldsymbol{\omega}_d)]+\frac{1}{2}(1-s_e)\boldsymbol{v}_e^{\mathrm{T}}(\boldsymbol{\omega}_b-\boldsymbol{\omega}_d)\end{aligned}\tag{2.18}</script><p>当$\boldsymbol{\omega}_b=-2K_1\boldsymbol{v}_e+\boldsymbol{\omega}_d$时，有$\dot{V}_1=-\boldsymbol{v}_e^{\mathrm{T}}K_1\boldsymbol{v}_e\le0$。因此，定义虚拟控制量为</p><script type="math/tex; mode=display">\boldsymbol{v}_z=\boldsymbol{\omega}_b+2K_1\boldsymbol{v}_e-\boldsymbol{\omega}_d \tag{2.19}</script><p>则：</p><script type="math/tex; mode=display">\dot{V}_1=-\boldsymbol{v}_e^{\mathrm{T}}K_1\boldsymbol{v}_e+\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}\boldsymbol{v}_z \tag{2.20}</script><p>对公式(2.19)求导，可以得到$\boldsymbol{v}_z$的导数：</p><script type="math/tex; mode=display">\begin{aligned}\dot{\boldsymbol{v}}_z=&\dot{\boldsymbol{\omega}}_b+2K_1\dot{\boldsymbol{v}}_e-\dot{\boldsymbol{\omega}}_d\\=&J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau})+2K_1\dot{\boldsymbol{v}}_e-\dot{\boldsymbol{\omega}}_d\end{aligned}\tag{2.21}</script><p>其中：$\dot{\boldsymbol{v}}_e$在公式(2.15)给出。</p><p>&emsp;重新选择李雅普诺夫函数：</p><script type="math/tex; mode=display">V_2=V_1+\frac{1}{2}\boldsymbol{v}_z^{\mathrm{T}}\boldsymbol{v}_z\tag{2.22}</script><p>则：</p><script type="math/tex; mode=display">\dot{V}_2=-\boldsymbol{v}_e^{\mathrm{T}}K_1\boldsymbol{v}_e+\frac{1}{2}\boldsymbol{v}_e^{\mathrm{T}}\boldsymbol{v}_z+\boldsymbol{v}_z^{\mathrm{T}}[J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau})+2K_1\dot{\boldsymbol{v}}_e-\dot{\boldsymbol{\omega}}_d]\tag{2.23}</script><p>设计控制为：</p><script type="math/tex; mode=display">\boldsymbol{\tau}=\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+J[-K_2\boldsymbol{v}_z-2K_1\dot{\boldsymbol{v}}_e+\dot{\boldsymbol{\omega}}_d-\frac{1}{2}\boldsymbol{v}_e]\tag{2.24}</script><p>其中$K_2$为正定对角矩阵。将公式(2.24)代入(2.23)中可以得到：</p><script type="math/tex; mode=display">\dot{V}_2=-\boldsymbol{v}_e^{\mathrm{T}}K_1\boldsymbol{v}_e-\boldsymbol{v}_z^{\mathrm{T}}K_2\boldsymbol{v}_z\le0 \tag{2.25}</script><p>根据拉塞尔不变性原理，当$t\rightarrow \infty$时，$\boldsymbol{v}_e\rightarrow 0$和$\boldsymbol{v}_z \rightarrow 0$。对于前面提到的四元数数双倍覆盖导致的收敛问题，可以使用$\mathrm{sign}(s_e)\boldsymbol{q}_e$来代替$\boldsymbol{q}_e$解决。</p><h2><span id="23-基于so3的控制">2.3 基于$SO(3)$的控制</span></h2><p>&emsp;为了便于后续的控制器的推导，先给出两个结论。对于$\boldsymbol{\phi}_e=(R_e-R_e^{\mathrm{T}})^{\vee}$和任意的向量$\boldsymbol{z}$，满足以下关系：</p><ol><li>$\boldsymbol{\phi}_e^{\mathrm{T}}\boldsymbol{\phi}_e=\mathrm{tr}(I-R_eR_e)$</li><li>$\boldsymbol{z}^{\mathrm{T}}\boldsymbol{\phi}_e=-\mathrm{tr}[R_e\mathrm{sk}(\boldsymbol{z})]$</li></ol><p>这两个结论都可以利用这一性质导出：对于任意的$\boldsymbol{x},\boldsymbol{y}\in\mathbb{R}^3$满足$\boldsymbol{x}^{\mathrm{T}}\boldsymbol{y}=-\frac{1}{2}\mathrm{tr}[\mathrm{sk}(\boldsymbol{x})\mathrm{sk}(\boldsymbol{y})]$。</p><p>&emsp;记当前姿态和期望姿态的旋转矩阵分别为$R$和$R_d$，旋转误差为$R_e=R_d^{\mathrm{T}}R$。$SO(3)$空间中的旋转误差的动力学可以表示为：</p><script type="math/tex; mode=display">\begin{align}& \dot{R}_e=R_e\mathrm{sk}(\boldsymbol{\omega}_b)-\mathrm{sk}(\boldsymbol{\omega}_d)R_e \tag{2.26}\\&\dot{\boldsymbol{\omega}}_b=J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau}) \tag{2.27}\end{align}</script><p>&emsp;选取李雅普诺夫函数：</p><script type="math/tex; mode=display">V_1=\mathrm{tr}(I-R_e) \tag{2.28}</script><p>则：</p><script type="math/tex; mode=display">\dot{V}_1=-\mathrm{tr}[R_e\mathrm{sk}(\boldsymbol{\omega}_b)-\mathrm{sk}(\boldsymbol{\omega}_d)R_e] \tag{2.29}</script><p>当$\mathrm{sk}(\boldsymbol{\omega}_b)=-K_1(R_e-R_e^{\mathrm{T}})+R_e^{\mathrm{T}}\mathrm{sk}(\boldsymbol{\omega}_d)R_e$时，有:$\dot{V}_1=-\mathrm{tr}[K_1(I-R_eR_e)] \le 0$。因此设计虚拟控制量$\mathrm{sk}(\boldsymbol{z})=\mathrm{sk}(\boldsymbol{\omega}_b)+K_1(R_e-R_e^{\mathrm{T}})-R_e^{\mathrm{T}}\mathrm{sk}(\boldsymbol{\omega}_d)R_e$，即：</p><script type="math/tex; mode=display">\boldsymbol{z}=\boldsymbol{\omega}_b+K_1\boldsymbol{\phi}_e-R_e^{\mathrm{T}}\boldsymbol{\omega}_d \tag{2.30}</script><p>其中$K_1$为正定对角矩阵，则$\dot{V}_1$可以写作：</p><script type="math/tex; mode=display">\begin{aligned}\dot{V}_1=&-\mathrm{tr}[R_e\mathrm{sk}(\boldsymbol{\omega}_b)-\mathrm{sk}(\boldsymbol{\omega}_d)R_e]+\mathrm{tr}[R_e\mathrm{sk}(\boldsymbol{z})]-\mathrm{tr}[R_e\mathrm{sk}(\boldsymbol{z})]\\=&-\mathrm{tr}[K_1(I-R_eR_e)]-\mathrm{tr}[R_e\mathrm{sk}(\boldsymbol{z})]\\\le&-k_{m1}\boldsymbol{\phi}_e^{\mathrm{T}}\boldsymbol{\phi}_e+\boldsymbol{z}^{\mathrm{T}}\boldsymbol{\phi}_e\end{aligned}\tag{2.31}</script><p>其中$k_{m1}$为$K$矩阵中的最小元素。对公式(2.30)求导可以得到$\boldsymbol{z}$的导数：</p><script type="math/tex; mode=display">\begin{aligned}\dot{\boldsymbol{z}}=&\dot{\boldsymbol{\omega}}_b+K_1\dot{\boldsymbol{\phi}_e}-\boldsymbol{\Omega}_e\\=&J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau}+\boldsymbol{d})+K_1\dot{\boldsymbol{\phi}_e}-\boldsymbol{\Omega}_e\end{aligned}\tag{2.32}</script><p>其中：$\dot{\boldsymbol{\phi}_e}=(\dot{R}_e-\dot{R}_e^{\mathrm{T}})^{\vee}$，$\boldsymbol{\Omega}_e=\dot{R}_e^{\mathrm{T}}\boldsymbol{\omega}_d+R_e^{\mathrm{T}}\dot{\boldsymbol{\omega}}_d$。</p><p>&emsp;重新选择李雅普诺夫函数为：</p><script type="math/tex; mode=display">V_2=V_1+\frac{1}{2}\boldsymbol{z}^{\mathrm{T}}\boldsymbol{z}\tag{2.33}</script><p>则：</p><script type="math/tex; mode=display">\begin{aligned}\dot{V}_2\le&-k_{m1}\boldsymbol{\phi}_e^{\mathrm{T}}\boldsymbol{\phi}_e+\boldsymbol{z}^{\mathrm{T}}\boldsymbol{\phi}_e+\boldsymbol{z}^{\mathrm{T}}\dot{\boldsymbol{z}}\\=&-k_{m1}\boldsymbol{\phi}_e^{\mathrm{T}}\boldsymbol{\phi}_e+\boldsymbol{z}^{\mathrm{T}}\boldsymbol{\phi}_e\\&+\boldsymbol{z}^{\mathrm{T}}[J^{-1}(-\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+\boldsymbol{\tau})+K_1\dot{\boldsymbol{\phi}_e}-\boldsymbol{\Omega}_e]\end{aligned}\tag{2.34}</script><p>设计控制器为：</p><script type="math/tex; mode=display">\boldsymbol{\tau}=\boldsymbol{\omega}_b\times J\boldsymbol{\omega}_b+J(-K_2\boldsymbol{z}-\boldsymbol{\phi}_e-K_1\dot{\boldsymbol{\phi}}_e+\boldsymbol{\Omega}_e)\tag{2.35}</script><p>其中，$K_2$为正定对角矩阵，记$K_2$中的最小元素为$k_{m2}$，则：</p><script type="math/tex; mode=display">\dot{V}_2\le-k_{m1}\boldsymbol{\phi}_e^{\mathrm{T}}\boldsymbol{\phi}_e-k_{m2}\boldsymbol{z}^{\mathrm{T}}\boldsymbol{z}\le 0\tag{2.36}</script><p>对于$\dot{V}_2$，当且仅当$\boldsymbol{\phi}_e=0$和$\boldsymbol{z}=0$时$\dot{V}_2=0$，根据拉塞尔不变性原理，当$t\rightarrow \infty$时，$\boldsymbol{\phi}_e\rightarrow 0$和$\boldsymbol{z}\rightarrow 0$，对应的$R_e\rightarrow R_d$。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>姿态表示方法</title>
      <link href="/2022/10/29/y2022m11/%E5%A7%BF%E6%80%81%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95/"/>
      <url>/2022/10/29/y2022m11/%E5%A7%BF%E6%80%81%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p><strong>摘要：讨论不同的刚体姿态表示方法。包括：欧拉角、四元数、李群李代数。</strong></p><span id="more"></span><p>定义惯性坐标系为$O_i$，刚体坐标系为$O_b$</p><h1><span id="1-旋转矩阵">1 旋转矩阵</span></h1><p>&emsp;惯性坐标系下的刚体姿态可以使用旋转矩阵表示：</p><script type="math/tex; mode=display">R=[\boldsymbol{r}_1,\boldsymbol{r}_2,\boldsymbol{r}_3]^{\mathrm{T}} \tag{1}</script><p>其中：$\boldsymbol{r}_1,\boldsymbol{r}_2,\boldsymbol{r}_3$分别表示刚体坐标系x,y,z方向上的单位向量在惯性坐标系中的表示。</p><p>&emsp;旋转矩阵为单位矩阵。满足性质：</p><script type="math/tex; mode=display">\mathrm{det}(R)=I,~R^{\mathrm{T}}R=I \tag{2}</script><h2><span id="11-绕xyz轴的旋转">1.1 绕x,y,z轴的旋转</span></h2><script type="math/tex; mode=display">Rot_x(\theta)=\begin{bmatrix}  1& 0 &0 \\  0& \mathrm{cos}\theta &-\mathrm{sin}\theta \\  0&  \mathrm{sin}\theta&\mathrm{cos}\theta\end{bmatrix}\\~\\Rot_y(\theta)=\begin{bmatrix}  \mathrm{cos}\theta& 0 &\mathrm{sin}\theta \\  0& 1&0\\  -\mathrm{sin}\theta&  0&\mathrm{cos}\theta\end{bmatrix}\\~\\Rot_z(\theta)=\begin{bmatrix}  \mathrm{cos}\theta& -\mathrm{sin}\theta&0 \\  \mathrm{sin}\theta& \mathrm{cos}\theta &0 \\  0&  0&1\end{bmatrix} \tag{3}</script><p>其中旋转方向可使用右手定则确定。</p><h2><span id="12-旋转矩阵的导数">1.2 旋转矩阵的导数</span></h2><p>&emsp;记刚体旋转的角速度在惯性坐标系和刚体坐标系下的表示分别为$\boldsymbol{\omega}_i$和$\boldsymbol{\omega}_b$。则旋转矩阵的导数可以表示为：</p><script type="math/tex; mode=display">\begin{align}&\dot{R}=\mathrm{sk}(\boldsymbol{\omega}_i)R \tag{4} \\ &\dot{R}=R\mathrm{sk}(\boldsymbol{\omega}_b) \tag{5} \end{align}</script><p>其中$\mathrm{sk}(\boldsymbol{\omega})=\begin{bmatrix}0 &amp; -\omega_z &amp;\omega_y \\  \omega_z&amp;0  &amp;-\omega_x \\<br> -\omega_y&amp;  \omega_x&amp; 0\end{bmatrix}$为向量$\boldsymbol{\omega}=[\omega_x,\omega_y,\omega_z]^{\mathrm{T}}$对应的反对称矩阵。公式(4)和(5)可以利用如下性质互相转化：</p><script type="math/tex; mode=display">R\mathrm{sk}(\boldsymbol{\omega})R^{\mathrm{T}}=\mathrm{sk}(R\boldsymbol{\omega}) \tag{6}</script><h1><span id="2-欧拉角">2 欧拉角</span></h1><p>&emsp;记依次绕自身坐标系z-y-x轴旋转的欧拉角为$\boldsymbol{\Phi}=[\phi,\theta,\psi]^\mathrm{T}$，欧拉角对应的旋转矩阵可以表示为：</p><script type="math/tex; mode=display">R=Rot_{z}(\psi)Rot_{y}(\theta)Rot_{x}(\phi)=\begin{bmatrix}  c\psi c\theta& c\psi s\theta s\phi-s\psi c\phi&c\psi s\theta c\phi+s\psi s\phi \\  s\psi c\theta&s\phi s\theta s\phi+c\psi c\phi   &s\psi s\theta c\phi-c\psi s\phi \\  -s\theta&  c\theta s\phi&c\theta c\phi\end{bmatrix} \tag{7}</script><h2><span id="21-由旋转矩阵计算欧拉角">2.1 由旋转矩阵计算欧拉角</span></h2><p>&emsp;记旋转矩阵为$R=\begin{bmatrix}<br>  r_{11}&amp;r_{12}&amp;r_{13} \\<br>  r_{21}&amp;r_{22}&amp;r_{23} \\<br>  r_{31}&amp;r_{32}&amp;r_{33}<br>\end{bmatrix}$，旋转矩阵对应的欧拉角可由以下方式计算：</p><ul><li>如果$r_{31}\neq\pm1$<ul><li>$\theta_1=-\mathrm{asin}(r_{31})$</li><li>$\theta_2=\pi-\theta_1$</li><li>$\phi_1=\mathrm{atan2}(\frac{r_{32}}{c\theta_1},\frac{r_{33}}{c\theta_1})$</li><li>$\phi_2=\mathrm{atan2}(\frac{r_{32}}{c\theta_2},\frac{r_{33}}{c\theta_2})$</li><li>$\psi_1=\mathrm{atan2}(\frac{r_{21}}{c\theta_1},\frac{r_{11}}{c\theta_1})$</li><li>$\psi_2=\mathrm{atan2}(\frac{r_{21}}{c\theta_2},\frac{r_{11}}{c\theta_2})$</li></ul></li><li>如果$r_{31}=\pm1$<ul><li>万向节死锁，$\psi$可为任意值</li><li>如果$r_{31}=1$<ul><li>$\theta=\pi/2$</li><li>$\phi=\psi+\mathrm{atan2}(r_{12},r_{13})$</li></ul></li><li>如果$r_{31}=-1$  <ul><li>$\theta=-\pi/2$</li><li>$\phi=-\psi+\mathrm{atan2}(-r_{12},-r_{13})$</li></ul></li></ul></li></ul><h2><span id="22-欧拉角的导数">2.2 欧拉角的导数</span></h2><p>&emsp;记$\boldsymbol{\Phi}=[\phi,\theta,\psi]^{\mathrm{T}}$为绕机体坐标轴按z-y-x顺序旋转的roll，pitch和yaw角，$\boldsymbol{\Phi}$的导数可表示为：</p><script type="math/tex; mode=display">\dot{\boldsymbol{\Phi}}=\begin{bmatrix}1 & \mathrm{sin}\phi \mathrm{tan}\theta&\mathrm{cos}\phi\mathrm{tan}\theta\\0 & \mathrm{cos}\phi & -\mathrm{sin}\phi\\0 & \mathrm{sin}\phi \mathrm{sec}\theta  & \mathrm{cos}\phi \mathrm{sec}\theta\end{bmatrix}\boldsymbol{\omega}_b \tag{8}</script><p>同时：</p><script type="math/tex; mode=display">\boldsymbol{\omega}_b=\begin{bmatrix}1 & 0&-\mathrm{sin}\theta\\0 & \mathrm{cos}\phi & \mathrm{sin}\phi\mathrm{cos}\theta\\0 & -\mathrm{sin}\phi & \mathrm{cos}\phi \mathrm{cos}\theta\end{bmatrix}\dot{\boldsymbol{\Phi}} \tag{9}</script><p>可以看出上述结论仅在$\theta\neq\pm\pi/2$的条件下成立。</p><p>&emsp;推导</p><script type="math/tex; mode=display">\begin{aligned}&\dot{R}=\dot{R}_{\psi}R_{\theta}R_{\phi}+R_{\psi}\dot{R}_{\theta}R_{\phi}+R_{\psi}R_{\theta}\dot{R}_{\phi}=R_{\psi}R_{\theta}R_{\phi}\mathrm{sk}(\boldsymbol{\omega_b})\\&R_{\phi}^{\mathrm{T}}R_{\theta}^{\mathrm{T}}R_{\psi}^{\mathrm{T}}\dot{R}_{\psi}R_{\theta}R_{\phi}+R_{\phi}^{\mathrm{T}}R_{\theta}^{\mathrm{T}}\dot{R}_{\theta}R_{\phi}+R_{\phi}^{\mathrm{T}}\dot{R}_{\phi}=\mathrm{sk}(\boldsymbol{\omega_b})\\&R_{\phi}^{\mathrm{T}}R_{\theta}^{\mathrm{T}}\mathrm{sk}([0,0,\dot{\psi}]^{\mathrm{T}})R_{\theta}R_{\phi}+R_{\phi}^{\mathrm{T}}\mathrm{sk}([0,\dot{\theta},0]^{\mathrm{T}})R_{\theta}+\mathrm{sk}([\dot{\phi},0,0]^{\mathrm{T}})=\mathrm{sk}(\boldsymbol{\omega_b})\\&\mathrm{sk}(R_{\phi}^{\mathrm{T}}R_{\theta}^{\mathrm{T}}[0,0,\dot{\psi}]^{\mathrm{T}})+\mathrm{sk}(R_{\phi}^{\mathrm{T}}[0,\dot{\theta},0]^{\mathrm{T}})+\mathrm{sk}([\dot{\phi},0,0]^{\mathrm{T}})=\mathrm{sk}(\boldsymbol{\omega_b})\\&\boldsymbol{\omega_b}=R_{\phi}^{\mathrm{T}}R_{\theta}^{\mathrm{T}}[0,0,\dot{\psi}]^{\mathrm{T}}+R_{\phi}^{\mathrm{T}}[0,\dot{\theta},0]^{\mathrm{T}}+[\dot{\phi},0,0]^{\mathrm{T}}\end{aligned}</script><h1><span id="3-四元数">3 四元数</span></h1><p>&emsp;单位四元数可用于旋转的表示：</p><script type="math/tex; mode=display">\boldsymbol{q}=[s,\boldsymbol{v}]^{\mathrm{T}} =[cos\frac{\theta}{2},\boldsymbol{n}sin\frac{\theta}{2}]^{\mathrm{T}} \tag{10}</script><p>其中$\theta\in\mathbb{R}$和$\boldsymbol{n}\in\mathbb{R}^3$分别为旋转角和单位旋转轴，$||\boldsymbol{q}||=1$。</p><h2><span id="31-四元数的运算">3.1 四元数的运算</span></h2><p>&emsp;定义两个四元数$\boldsymbol{q}_1=[s_1,\boldsymbol{v}_1]^{\mathrm{T}}$和$\boldsymbol{q}_2=[s_2,\boldsymbol{v}_2]^{\mathrm{T}}$。</p><p><strong>加法运算</strong></p><script type="math/tex; mode=display">\boldsymbol{q}_1\pm\boldsymbol{q}_2=[s_1\pm s_2,\boldsymbol{v}_1\pm\boldsymbol{v}_2]^{\mathrm{T}} \tag{11}</script><p><strong>积运算</strong></p><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{q}_1\otimes\boldsymbol{q}_2=\begin{bmatrix} s_1&-\boldsymbol{v}^{\mathrm{T}}_1 \\  \boldsymbol{v}_1&s_1I+\mathrm{sk}(\boldsymbol{v}_1) \end{bmatrix}\boldsymbol{q}_2=Q\boldsymbol{q}_2\\&\boldsymbol{q}_1\otimes\boldsymbol{q}_2=\begin{bmatrix} s_2&-\boldsymbol{v}^{\mathrm{T}}_2 \\  \boldsymbol{v}_2&s_2I-\mathrm{sk}(\boldsymbol{v}_2) \end{bmatrix}\boldsymbol{q}_1=\bar{Q}\boldsymbol{q}_1\end{aligned}\tag{12}</script><p>或</p><script type="math/tex; mode=display">\boldsymbol{q}_1\otimes\boldsymbol{q}_2=[s_1s_2-\boldsymbol{v}_1^{\mathrm{T}}\boldsymbol{v}_2,s_1\boldsymbol{v}_2+s_2\boldsymbol{v}_1+\boldsymbol{v}_1\times\boldsymbol{v}_2]^{\mathrm{T}} \tag{13}</script><p><strong>共轭与逆</strong><br>&emsp;$\boldsymbol{q}_1$的共轭为：</p><script type="math/tex; mode=display">\bar{\boldsymbol{q}}_1=[s_1,-\boldsymbol{v}_1]^{\mathrm{T}} \tag{14}</script><p>&emsp;$\boldsymbol{q}_1$的逆为：</p><script type="math/tex; mode=display">\boldsymbol{q}_1^{-1}=\frac{\bar{\boldsymbol{q}}_1}{||\boldsymbol{q}_1||}=\bar{\boldsymbol{q}}_1 \tag{15}</script><p>&emsp;共轭四元数满足关系：</p><script type="math/tex; mode=display">\begin{aligned}&Q^{\mathrm{T}}(\boldsymbol{q})=Q(\bar{\boldsymbol{q}})\\&\bar{Q}^{\mathrm{T}}(\boldsymbol{q})=\bar{Q}(\bar{\boldsymbol{q}}) \end{aligned}\tag{16}</script><h2><span id="32-四元数旋转变换">3.2 四元数旋转变换</span></h2><p>&emsp;定义矢量$\boldsymbol{p}=[0,x,y,z]^{\mathrm{T}}$，四元数$\boldsymbol{q}=[s,\boldsymbol{v}]^{\mathrm{T}}$。经四元数$\boldsymbol{q}$变换得到的矢量$\boldsymbol{p}’$可表示为：</p><script type="math/tex; mode=display">\boldsymbol{p}'=\boldsymbol{q}\otimes\boldsymbol{p}\otimes\boldsymbol{q}^* \tag{17}</script><p>写成矩阵形式：</p><script type="math/tex; mode=display">\boldsymbol{p}'=\begin{bmatrix} s&-\boldsymbol{v}^{\mathrm{T}} \\  \boldsymbol{v}&sI+\mathrm{sk}(\boldsymbol{v}) \end{bmatrix}\begin{bmatrix} s&\boldsymbol{v}^{\mathrm{T}} \\  -\boldsymbol{v}&sI+\mathrm{sk}(\boldsymbol{v}) \end{bmatrix}\boldsymbol{p} \tag{18}</script><h2><span id="33-四元数-旋转矩阵和欧拉角">3.3 四元数、旋转矩阵和欧拉角</span></h2><p><strong>四元数对应的旋转矩阵</strong><br>&emsp;由(18)可以得到四元数对应的旋转矩阵为</p><script type="math/tex; mode=display">R=\boldsymbol{v}\boldsymbol{v}^{\mathrm{T}}+(sI+\mathrm{sk}(\boldsymbol{v}))(sI+\mathrm{sk}(\boldsymbol{v}))\tag{19}</script><p>展开可写作：</p><script type="math/tex; mode=display">R=\begin{bmatrix} 1-2v_y^2-2v_z^2&2v_xv_y-2sv_z&2v_xv_z+2sv_y \\  2v_xv_y+2sv_z& 1-2v_x^2-2v_z^2&2v_yv_z-2sv_x\\ 2v_xv_z-2sv_y&2v_yv_z+2sv_x&1-2v_x^2-2v_y^2\end{bmatrix} \tag{20}</script><p><strong>欧拉角对应的四元数</strong><br>&emsp;$\boldsymbol{\Phi}=[\phi,\theta,\psi]^{\mathrm{T}}$绕机体轴按z-y-x顺序的欧拉角对应的四元数可表示为：</p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{q}=&\begin{bmatrix}\mathrm{cos}(\psi/2)\\  0\\ 0\\ \mathrm{sin}(\psi/2)\end{bmatrix}\otimes\begin{bmatrix}\mathrm{cos}(\theta/2)\\  0\\ \mathrm{sin}(\theta/2)\\ 0\end{bmatrix}\otimes\begin{bmatrix}\mathrm{cos}(\phi/2)\\ \mathrm{sin}(\phi/2)\\0\\0\end{bmatrix}\\=&\begin{bmatrix}c(\phi/2)c(\theta/2)c(\psi/2)+s(\phi/2)s(\theta/2)s(\psi/2)\\ s(\phi/2)c(\theta/2)c(\psi/2)-c(\phi/2)s(\theta/2)s(\psi/2)\\c(\phi/2)s(\theta/2)c(\psi/2)+s(\phi/2)c(\theta/2)s(\psi/2)\\c(\phi/2)c(\theta/2)s(\psi/2)-s(\phi/2)s(\theta/2)c(\psi/2)\end{bmatrix}\end{aligned} \tag{21}</script><p><strong>旋转矩阵对应的四元数</strong><br>&emsp;记旋转矩阵为$R=\begin{bmatrix}<br>  r_{11}&amp;r_{12}&amp;r_{13} \\<br>  r_{21}&amp;r_{22}&amp;r_{23} \\<br>  r_{31}&amp;r_{32}&amp;r_{33}<br>\end{bmatrix}$，旋转矩阵对应的四元数$\boldsymbol{q}=[s,v_x,v_y,v_z]^{\mathrm{T}}$可由以下方式计算：</p><script type="math/tex; mode=display">\begin{aligned}&s=\frac{1}{2}\sqrt{1+r_{11}^2+r_{22}^2+r_{33}^2}\\&v_x=\frac{1}{2}\sqrt{1+r_{11}^2-r_{22}^2-r_{33}^2}\\&v_y=\frac{1}{2}\sqrt{1-r_{11}^2+r_{22}^2-r_{33}^2}\\&v_z=\frac{1}{2}\sqrt{1-r_{11}^2-r_{22}^2+r_{33}^2}\\\end{aligned}\tag{22}</script><h2><span id="34-四元数的导数">3.4 四元数的导数</span></h2><p>&emsp;定义四元数$\boldsymbol{q}=[s,\boldsymbol{v}]^{\mathrm{T}}$，$\boldsymbol{q}$的导数可以表示为：</p><script type="math/tex; mode=display">\begin{aligned}&\dot{\boldsymbol{q}}=\frac{1}{2}[0,\boldsymbol{\omega}_i]^{\mathrm{T}}\otimes\boldsymbol{q}=\frac{1}{2}\begin{bmatrix} s&-\boldsymbol{v}^{\mathrm{T}} \\  \boldsymbol{v}&sI-\mathrm{sk}(\boldsymbol{v}) \end{bmatrix}\begin{bmatrix}0\\\boldsymbol{\omega}_i\end{bmatrix}\\&\dot{\boldsymbol{q}}=\frac{1}{2}\boldsymbol{q}\otimes[0,\boldsymbol{\omega}_b]^{\mathrm{T}}=\frac{1}{2}\begin{bmatrix} s&-\boldsymbol{v}^{\mathrm{T}} \\  \boldsymbol{v}&sI+\mathrm{sk}(\boldsymbol{v}) \end{bmatrix}\begin{bmatrix}0\\\boldsymbol{\omega}_b\end{bmatrix}\end{aligned} \tag{23}</script><h1><span id="4-李群李代数">4 李群李代数</span></h1><h2><span id="41-so3和se3群">4.1 $SO(3)$和$SE(3)$群</span></h2><p>&emsp;群是一个集合$A$和一种运算$\cdot$构成的代数结构。集合$A$和运算$\cdot$需要满足以下条件：</p><ul><li>封闭性：$\forall a_1,a_2\in A, \: a_1\cdot a_2\in A$</li><li>结合律：$\forall a_1,a_2,a_3\in A, \:\: (a_1\cdot a_2)\cdot a_3=a_1\cdot  (a_2\cdot a_3)$</li><li>有单位元（幺元）：$\exists a_0\in A,\:s.t. \:\forall a\in A,\:a_0\cdot a=a\cdot a_0=a$</li><li>有逆元：$\forall a\in A,\: \exists a^{-1}\in A,\: a\cdot a^{-1}=a_0$</li></ul><p>可以看出，旋转矩阵和矩阵乘法是一个李群，记作特殊正交群$SO(3)$：</p><script type="math/tex; mode=display">SO(3)=\{R\in\mathbb{R}^{3\times3}|RR^{\mathrm{T}}=I,\mathrm{det}(R)=1\} \tag{24}</script><p>其中$I\in\mathbb{R}^3$为三维单位矩阵。同样齐次变换矩阵和矩阵乘法也是一个李群，记作特殊欧式群$SE(3)$：</p><script type="math/tex; mode=display">SE(3)=\{T=\begin{bmatrix}R&\boldsymbol{t}\\\boldsymbol{0}&1\end{bmatrix}\in\mathbb{R}^{4\times4}|R\in SO(3),\boldsymbol{t}\in\mathbb{R}^3\} \tag{25}</script><h2><span id="42-mathfrakso3和mathfrakse3李代数">4.2 $\mathfrak{so}(3)$和$\mathfrak{se}(3)$李代数</span></h2><p>&emsp;每个李群都有对应的李代数，李代数描述了李群的局部性质，因此也称为群的切空间。李代数由一个集合$\mathbb{V}$，一个数域$\mathbb{F}$和一个二元运算$[,]$组成的代数结构。集合$\mathbb{V}$，数域$\mathbb{F}$和二元运算$[,]$需要满足以下条件：</p><ul><li>封闭性：$\forall X,Y\in\mathbb{V},~[X,Y]\in\mathbb{V}$</li><li>双线性：$\forall X,Y,Z\in\mathbb{V},~a,b\in\mathbb{F}$，有$[aX+bY,Z]=a[X,Z]+b[Y,Z]$和$[Z,aX+bY]=a[Z,X]+b[Z,Y]$</li><li>自反性：$\forall X\in\mathbb{V},~[X,Z]=0$</li><li>雅可比等价性：$\forall X,Y,Z\in\mathbb{V}$，有$[X,[Y,Z]]+[Z,[X,Y]]+[Y,[Z,X]]=0$</li></ul><p>其中二元运算$[,]$也称为李括号。可以看出，向量是一个李代数，其对应的李括号为向量积运算。向量对应的反对称矩阵也是一个李代数，反对称矩阵$\Phi_1$和$\Phi_2$的李括号为运算：$[\Phi_1,\Phi_2]=\Phi_1\Phi_2-\Phi_2\Phi_1$。向量和对应反对称矩阵的李括号运算是等价的。</p><p>&emsp;$SO(3)$群对应的李代数为一个$\mathbb{R}^3$向量或该向量对应的$\mathbb{R}^{3\times3}$反对称矩阵，记作：</p><script type="math/tex; mode=display">\mathfrak{so}(3)=\{ \boldsymbol{\phi}\in\mathbb{R}^3,\Phi=\boldsymbol{\phi}^{\wedge}\in\mathbb{R}^{3\times3} \} \tag{26}</script><p>其中，在$\mathfrak{so}(3)$的定义中，$\wedge$为向量到反对称矩阵的映射，记作$\mathbb{R}^3\rightarrow\mathbb{R}^{3\times3}~\rm{in}~\mathfrak{so}(3)$；$\vee$为反对称矩阵到向量的映射，记作$\mathbb{R^{3\times3}}\rightarrow\mathbb{R}^3~\rm{in}~\mathfrak{so}(3)$。对应的李括号为$[\boldsymbol{\phi}_1, \boldsymbol{\phi}_2]=\boldsymbol{\phi}_1\times\boldsymbol{\phi}_2$或$[\boldsymbol{\phi}_1,\boldsymbol{\phi}_2]=(\Phi_1\Phi_2-\Phi_2\Phi_1)^{\vee}$</p><p>&emsp;$SE(3)$群对应的李代数为一个$\mathbb{R}^6$向量或该向量对应的$\mathbb{R}^{4\times4}$矩阵，记作：</p><script type="math/tex; mode=display">\mathfrak{se}(3)=\{ \boldsymbol{\xi}=\begin{bmatrix}\boldsymbol{\rho}\\ \boldsymbol{\phi}\end{bmatrix}\in\mathbb{R}^6,\boldsymbol{\rho}\in\mathbb{R}^3,\boldsymbol{\phi}\in\mathfrak{so}(3),\boldsymbol{\xi}^{\wedge}=\begin{bmatrix}\boldsymbol{\phi}^{\wedge}&\boldsymbol{\rho}\\\boldsymbol{0}&0\end{bmatrix}\in\mathbb{R}^{4\times4} \} \tag{27}</script><p>其中，在$\mathfrak{se}(3)$的定义中，$\wedge$为$\mathbb{R}^6\rightarrow\mathbb{R}^{4\times4}~\rm{in}~\mathfrak{se}(3)$的映射；$\vee$为$\mathbb{R^{4\times4}}\rightarrow\mathbb{R}^6~\rm{in}~\mathfrak{se}(3)$。对应的李括号为$[\boldsymbol{\xi}_1, \boldsymbol{\xi}_2]=(\boldsymbol{\xi}^{\wedge}_1\boldsymbol{\xi}^{\wedge}_2-\boldsymbol{\xi}^{\wedge}_2\boldsymbol{\xi}^{\wedge}_1)^{\vee}$。</p><h2><span id="43-指数映射和对数映射">4.3 指数映射和对数映射</span></h2><p>&emsp;李群和李代数之间可以通过指数映射和对数映射互相转化：</p><p><strong>指数映射</strong>：</p><ol><li>$\mathfrak{so}(3)\rightarrow SO(3)$:<script type="math/tex; mode=display">R=\mathrm{exp}(\boldsymbol{\phi}^{\wedge}) \tag{28}</script>记：$\boldsymbol{\phi}=\theta\boldsymbol{a}$，$\boldsymbol{a}\in\mathbb{R}^3$为单位向量，利用泰勒展开，指数映射可以表示为:<script type="math/tex; mode=display">\mathrm{exp}(\theta\boldsymbol{a}^{\wedge})=\mathrm{cos}\theta I+(1-\mathrm{cos}\theta)\boldsymbol{a}\boldsymbol{a}^{\mathrm{T}}+\mathrm{sin}\theta\boldsymbol{a}^{\wedge} \tag{29}</script></li></ol><ol><li>$\mathfrak{se}(3)\rightarrow SE(3)$：<script type="math/tex; mode=display">\begin{aligned}&T=\begin{bmatrix}\mathrm{exp}(\boldsymbol{\phi}^{\wedge})&J\boldsymbol{\rho}\\\boldsymbol{0}&1\end{bmatrix}\\&J=\frac{\mathrm{sin}\theta}{\theta}I+(1-\frac{\mathrm{sin}\theta}{\theta})\boldsymbol{a}\boldsymbol{a}^{\mathrm{T}}+\frac{1-\mathrm{cos}\theta}{\theta}\boldsymbol{a}^{\wedge}\end{aligned}\tag{30}</script></li></ol><p><strong>对数映射</strong>：</p><ol><li>$SO(3)\rightarrow \mathfrak{so}(3)$:<script type="math/tex; mode=display">\boldsymbol{\phi}=\mathrm{ln}(R)^{\vee} \tag{31}</script>记$\boldsymbol{a}=[a_x,a_y,a_z]^{\mathrm{T}}$，对公式(29)展开：<script type="math/tex; mode=display">R=\begin{bmatrix}a_x^2+(1-a_x^2)\mathrm{cos}\theta&a_xa_y(1-\mathrm{cos}\theta)-a_z\mathrm{sin}\theta&a_xa_z(1-\mathrm{cos}\theta)+a_y\mathrm{sin}\theta \\ a_xa_y(1-\mathrm{cos}\theta)+a_z\mathrm{sin}\theta&  a_y^2+(1-a_y^2)\mathrm{cos}\theta&a_ya_z(1-\mathrm{cos}\theta)-a_x\mathrm{sin}\theta\\a_xa_z(1-\mathrm{cos}\theta)-a_y\mathrm{sin}\theta&a_ya_z(1-\mathrm{cos}\theta)+a_x\mathrm{sin}\theta& a_z^2+(1-a_z^2)\mathrm{cos}\theta\end{bmatrix} \tag{32}</script>可得：<script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{\phi}=\theta\boldsymbol{a}\\&\theta=\mathrm{acos}(\frac{\mathrm{tr}(R)-1}{2})\\&\boldsymbol{a}=\frac{1}{2\mathrm{sin}\theta}(R-R^{\mathrm{T}})^{\vee}=\frac{(R-R^{\mathrm{T}})^{\vee}}{||(R-R^{\mathrm{T}})^{\vee}||} \\&\mathrm{ln}(R)=\frac{\theta}{2\mathrm{sin}\theta}(R-R^{\mathrm{T}})\end{aligned}\tag{33}</script></li></ol><ol><li>$SE(3)\rightarrow\mathfrak{se}(3)$:<script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{\xi}=\begin{bmatrix}\boldsymbol{\rho}\\ \boldsymbol{\phi}\end{bmatrix}\\&\boldsymbol{\phi}=\mathrm{ln}(R)^{\vee}\\&\boldsymbol{\rho}=J^{-1}\boldsymbol{t}\end{aligned}\tag{34}</script></li></ol><p>&emsp;可以看出李代数将$SO(3)$群映射为了一个$\mathbb{R}^3$向量，把$SE(3)$群映射成了一个$\mathbb{R}^6$向量。</p><h1><span id="5-总结和比较">5 总结和比较</span></h1><h3><span id="51-旋转表示的目标">5.1 旋转表示的目标</span></h3><ol><li><p>把旋转表示成一个$\mathbb{R}^3$向量。在运动学和动力学中的角速度$\boldsymbol{\omega}$和力矩$\boldsymbol{\tau}$是$\mathbb{R}^3$向量。因此将旋转表示成$\mathbb{R}^3$向量有助于控制算法和优化算法的设计。</p></li><li><p>能够使用简单的运算连续且平滑地表示旋转的误差和插值。$SO(3)$不是一个线性空间，当把旋转表示成$\mathbb{R}^3$后，$\mathbb{R}^3$上的线性差值和增量在$SO(3)$空间中并不是两个姿态之间的最短路径。如果直接使$\mathbb{R}^3$的线性差值和增量来表示旋转误差或插值，会导致旋转不平滑，甚至奇异问题的出现。因此，在把旋转表示成$\mathbb{R}^3$向量后，还需要能找到一种关于这个向量的简单运算，使得其能够被用于$SO(3)$空间中旋转误差的表示。</p></li></ol><h3><span id="51-旋转表示法的物理含义">5.1 旋转表示法的物理含义</span></h3><p><strong>旋转的“最短路径”</strong><br>&emsp;欧拉旋转定理表明，在三维空间里，一个刚体在做一个旋转的时候，刚体内部至少有一点固定不动。因此刚体的三维旋转可以表示为绕着一个经过旋转点的固定轴的旋转。对于一个刚体，如果能够找到两个姿态之间的旋转轴和旋转角，让一个姿态绕着旋转旋转对应角度到达另一个姿态，则认为这个旋转是两个姿态之间的“最短路径”。在$SO(3)$空间中需要使用这一“最短旋转路径”来表示旋转误差和插值，以保证姿态控制和插值的连续平滑。</p><p><strong>欧拉角</strong><br>&emsp;欧拉角将旋转拆分成了3个简单的顺序旋转，能够帮助我们快速建立坐标系之间的旋转关系。对于一些机构，例如满足piper准则的机械臂球型手腕，其关节空间反映的就是末端坐标系的欧拉角空间，这在机构控制中会带来一些便捷。但欧拉角表示存在奇异，也就是常说的万向节死锁问题，这对大范围的姿态旋转表示是不利的，此外欧拉角也无法通过简单的运算来平滑地表示旋转误差和旋转插值。</p><p><strong>四元数</strong><br>&emsp;对于四元数$\boldsymbol{q}=[s,\boldsymbol{v}]^{\mathrm{T}}=[\mathrm{cos}\frac{\theta}{2},\mathrm{sin}\frac{\theta}{2}\boldsymbol{a}]^{\mathrm{T}}$。$\boldsymbol{a}$为轴角法中的旋转轴，$\theta$为绕旋转轴旋转的角度。四元数能够使用乘法运算来平滑地表示两个姿态的旋转误差，同时将这一误差映射到单位四维超球面$\mathbb{S}^3\subset\mathbb{R}^4$空间。<br>&emsp;根据轴角法的定义，对于相同的旋转轴，$\theta$和$\theta+2\pi$表示的是同一个旋转，将这两个角带如四元数表示中，会得到$\boldsymbol{q}=-\boldsymbol{q}$的结果，这就是四元数的双倍覆盖问题。也就是说值相同，符号相反的两个四元数表示的是同一个旋转，因此四元数对旋转的表示是不唯一的。</p><p><strong>李代数</strong><br>&emsp;对于李代数$\boldsymbol{\phi}=\theta\boldsymbol{a}$，$\boldsymbol{a}$为轴角法中的旋转轴，$\theta$为绕旋转轴旋转的角度。$SO(3)$空间的旋转误差通过李代数映射被成一个$\mathbb{R^3}$向量。</p><h2><span id="53-旋转表示法的比较">5.3 旋转表示法的比较</span></h2><div class="table-container"><table><thead><tr><th style="text-align:center">姿态描述</th><th style="text-align:center">所属空间</th><th style="text-align:center">全局性</th><th style="text-align:center">唯一性</th><th style="text-align:center">旋转误差</th><th style="text-align:center">误差范数在$SO(3)$空间中是否为最短路径</th></tr></thead><tbody><tr><td style="text-align:center">旋转矩阵</td><td style="text-align:center">$SO(3)\subset\mathbb{R}^{3\times3}$</td><td style="text-align:center">是</td><td style="text-align:center">是</td><td style="text-align:center">$R_d^\mathrm{T}R\rightarrow I$</td><td style="text-align:center">是</td></tr><tr><td style="text-align:center">欧拉角</td><td style="text-align:center">$\mathbb{R}^3$</td><td style="text-align:center">否</td><td style="text-align:center">否</td><td style="text-align:center">$\boldsymbol{\Phi}-\boldsymbol{\Phi}_d\rightarrow \boldsymbol{0}$</td><td style="text-align:center">否</td></tr><tr><td style="text-align:center">四元数</td><td style="text-align:center">$\mathbb{S}^3\subset\mathbb{R}^4$</td><td style="text-align:center">是</td><td style="text-align:center">否</td><td style="text-align:center">$\bar{\boldsymbol{q}}_d\otimes\boldsymbol{q}\rightarrow[1,0,0,0]^\mathrm{T}$</td><td style="text-align:center">是</td></tr><tr><td style="text-align:center">轴角法</td><td style="text-align:center">$\mathbb{R}^4$</td><td style="text-align:center">是</td><td style="text-align:center">否</td><td style="text-align:center">$\theta-\theta_d\rightarrow 0$</td><td style="text-align:center">是</td></tr><tr><td style="text-align:center">李代数</td><td style="text-align:center">$\mathfrak{so}_3\subset\mathbb{R}^3$</td><td style="text-align:center">是</td><td style="text-align:center">是</td><td style="text-align:center">$\mathrm{ln}(R_d^\mathrm{T}R)^{\vee}\rightarrow \boldsymbol{0}$</td><td style="text-align:center">是</td></tr></tbody></table></div><p><strong>参考文献</strong></p><blockquote><p>[1] Lynch K M, Park F C. Modern robotics[M]. Cambridge University Press, 2017.<br>[2] Chaturvedi N A, Sanyal A K, McClamroch N H. Rigid-body attitude control[J]. IEEE control systems magazine, 2011, 31(3): 30-51.<br>[3] <a href="https://github.com/Krasjet/quaternion">https://github.com/Krasjet/quaternion</a><br>[4] 高翔，张涛，”视觉SLAM十四讲”[M]. 电子工业出版社，2017.</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
